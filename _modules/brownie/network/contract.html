<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>brownie.network.contract &mdash; ypricemagic  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ypricemagic
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/modules.html">y</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ypricemagic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">brownie.network.contract</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for brownie.network.contract</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">TextWrapper</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">get_ident</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Coroutine</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Match</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">import</span> <span class="nn">eth_abi</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">solcx</span>
<span class="kn">from</span> <span class="nn">eth_utils</span> <span class="kn">import</span> <span class="n">combomethod</span><span class="p">,</span> <span class="n">remove_0x_prefix</span>
<span class="kn">from</span> <span class="nn">hexbytes</span> <span class="kn">import</span> <span class="n">HexBytes</span>
<span class="kn">from</span> <span class="nn">semantic_version</span> <span class="kn">import</span> <span class="n">Version</span>
<span class="kn">from</span> <span class="nn">vvm</span> <span class="kn">import</span> <span class="n">get_installable_vyper_versions</span>
<span class="kn">from</span> <span class="nn">vvm.utils.convert</span> <span class="kn">import</span> <span class="n">to_vyper_version</span>
<span class="kn">from</span> <span class="nn">web3._utils</span> <span class="kn">import</span> <span class="n">filters</span>
<span class="kn">from</span> <span class="nn">web3.datastructures</span> <span class="kn">import</span> <span class="n">AttributeDict</span>
<span class="kn">from</span> <span class="nn">web3.types</span> <span class="kn">import</span> <span class="n">LogReceipt</span>

<span class="kn">from</span> <span class="nn">brownie._config</span> <span class="kn">import</span> <span class="n">BROWNIE_FOLDER</span><span class="p">,</span> <span class="n">CONFIG</span><span class="p">,</span> <span class="n">REQUEST_HEADERS</span><span class="p">,</span> <span class="n">_load_project_compiler_config</span>
<span class="kn">from</span> <span class="nn">brownie.convert.datatypes</span> <span class="kn">import</span> <span class="n">Wei</span>
<span class="kn">from</span> <span class="nn">brownie.convert.normalize</span> <span class="kn">import</span> <span class="n">format_input</span><span class="p">,</span> <span class="n">format_output</span>
<span class="kn">from</span> <span class="nn">brownie.convert.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">build_function_selector</span><span class="p">,</span>
    <span class="n">build_function_signature</span><span class="p">,</span>
    <span class="n">get_type_strings</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">brownie.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BrownieCompilerWarning</span><span class="p">,</span>
    <span class="n">BrownieEnvironmentWarning</span><span class="p">,</span>
    <span class="n">ContractExists</span><span class="p">,</span>
    <span class="n">ContractNotFound</span><span class="p">,</span>
    <span class="n">UndeployedLibrary</span><span class="p">,</span>
    <span class="n">VirtualMachineError</span><span class="p">,</span>
    <span class="n">decode_typed_error</span><span class="p">,</span>
    <span class="n">parse_errors_from_abi</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">brownie.project</span> <span class="kn">import</span> <span class="n">compiler</span>
<span class="kn">from</span> <span class="nn">brownie.project.flattener</span> <span class="kn">import</span> <span class="n">Flattener</span>
<span class="kn">from</span> <span class="nn">brownie.typing</span> <span class="kn">import</span> <span class="n">AccountsType</span><span class="p">,</span> <span class="n">TransactionReceiptType</span>
<span class="kn">from</span> <span class="nn">brownie.utils</span> <span class="kn">import</span> <span class="n">color</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">.event</span> <span class="kn">import</span> <span class="n">_add_deployment_topics</span><span class="p">,</span> <span class="n">_get_topics</span><span class="p">,</span> <span class="n">event_watcher</span>
<span class="kn">from</span> <span class="nn">.state</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_add_contract</span><span class="p">,</span>
    <span class="n">_add_deployment</span><span class="p">,</span>
    <span class="n">_find_contract</span><span class="p">,</span>
    <span class="n">_get_deployment</span><span class="p">,</span>
    <span class="n">_remove_contract</span><span class="p">,</span>
    <span class="n">_remove_deployment</span><span class="p">,</span>
    <span class="n">_revert_register</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.web3</span> <span class="kn">import</span> <span class="n">ContractEvent</span><span class="p">,</span> <span class="n">_ContractEvents</span><span class="p">,</span> <span class="n">_resolve_address</span><span class="p">,</span> <span class="n">web3</span>

<span class="n">_unverified_addresses</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="n">_explorer_tokens</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;optimistic&quot;</span><span class="p">:</span> <span class="s2">&quot;OPTIMISMSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;etherscan&quot;</span><span class="p">:</span> <span class="s2">&quot;ETHERSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bscscan&quot;</span><span class="p">:</span> <span class="s2">&quot;BSCSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;zkevm&quot;</span><span class="p">:</span> <span class="s2">&quot;ZKEVMSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;polygonscan&quot;</span><span class="p">:</span> <span class="s2">&quot;POLYGONSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ftmscan&quot;</span><span class="p">:</span> <span class="s2">&quot;FTMSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arbiscan&quot;</span><span class="p">:</span> <span class="s2">&quot;ARBISCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;snowtrace&quot;</span><span class="p">:</span> <span class="s2">&quot;SNOWTRACE_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;aurorascan&quot;</span><span class="p">:</span> <span class="s2">&quot;AURORASCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;moonscan&quot;</span><span class="p">:</span> <span class="s2">&quot;MOONSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gnosisscan&quot;</span><span class="p">:</span> <span class="s2">&quot;GNOSISSCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="s2">&quot;BASESCAN_TOKEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blast&quot;</span><span class="p">:</span> <span class="s2">&quot;BLASTSCAN_TOKEN&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">_ContractBase</span><span class="p">:</span>
    <span class="n">_dir_color</span> <span class="o">=</span> <span class="s2">&quot;bright magenta&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">build</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">sources</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build</span> <span class="o">=</span> <span class="n">build</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sources</span> <span class="o">=</span> <span class="n">sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="n">_get_topics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">build_function_selector</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span>
        <span class="p">}</span>
        <span class="c1"># this isn&#39;t fully accurate because of overloaded methods - will be removed in `v2.0.0`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signatures</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">build_function_selector</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span>
        <span class="p">}</span>
        <span class="n">parse_errors_from_abi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">abi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;abi&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;contractName&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display NatSpec documentation for this contract.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;natspec&quot;</span><span class="p">):</span>
            <span class="n">_print_natspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;natspec&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calldata</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">calldata</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calldata</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode input calldata for this contract.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        calldata : str | bytes</span>
<span class="sd">            Calldata for a call to this contract</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Signature of the function that was called</span>
<span class="sd">        Any</span>
<span class="sd">            Decoded input arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">calldata</span><span class="p">,</span> <span class="n">HexBytes</span><span class="p">):</span>
            <span class="n">calldata</span> <span class="o">=</span> <span class="n">HexBytes</span><span class="p">(</span><span class="n">calldata</span><span class="p">)</span>

        <span class="n">fn_selector</span> <span class="o">=</span> <span class="n">calldata</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">i</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="ow">and</span> <span class="n">build_function_selector</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">fn_selector</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">abi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Four byte selector does not match the ABI for this contract&quot;</span><span class="p">)</span>

        <span class="n">function_sig</span> <span class="o">=</span> <span class="n">build_function_signature</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>

        <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">eth_abi</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">types_list</span><span class="p">,</span> <span class="n">calldata</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="n">input_args</span> <span class="o">=</span> <span class="n">format_input</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">function_sig</span><span class="p">,</span> <span class="n">input_args</span>


<span class="k">class</span> <span class="nc">ContractContainer</span><span class="p">(</span><span class="n">_ContractBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List-like container class that holds all Contract instances of the same</span>
<span class="sd">    type, and is used to deploy new instances of that contract.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        abi: Complete contract ABI.</span>
<span class="sd">        bytecode: Bytecode used to deploy the contract.</span>
<span class="sd">        signatures: Dictionary of {&#39;function name&#39;: &quot;bytes4 signature&quot;}</span>
<span class="sd">        topics: Dictionary of {&#39;event name&#39;: &quot;bytes32 topic&quot;}&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">build</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">=</span> <span class="n">build</span><span class="p">[</span><span class="s2">&quot;bytecode&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ProjectContract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">_sources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deploy</span> <span class="o">=</span> <span class="n">ContractConstructor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
        <span class="n">_revert_register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># messes with tests if it is created on init</span>
        <span class="c1"># instead we create when it&#39;s requested, but still define it here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span><span class="p">:</span> <span class="n">Flattener</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProjectContract&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="s2">&quot;cli&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;console&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">contract</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">:</span>
            <span class="n">_remove_contract</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
            <span class="n">contract</span><span class="o">.</span><span class="n">_reverted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_revert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reverted</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">tx</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">block_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">block_number</span> <span class="o">&gt;</span> <span class="n">height</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">4</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">contract</span> <span class="ow">in</span> <span class="n">reverted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
            <span class="n">contract</span><span class="o">.</span><span class="n">_reverted</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="s2">&quot;ProjectContract&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a contract from the container.</span>

<span class="sd">        Args:</span>
<span class="sd">            contract: Contract instance of address string of the contract.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">contract</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Object is not in container.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
        <span class="n">contract</span><span class="o">.</span><span class="n">_delete_deployment</span><span class="p">()</span>
        <span class="n">_remove_contract</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">at</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TransactionReceiptType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">persist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProjectContract&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a contract address.</span>

<span class="sd">        Raises ValueError if no bytecode exists at the address.</span>

<span class="sd">        Args:</span>
<span class="sd">            address: Address string of the contract.</span>
<span class="sd">            owner: Default Account instance to send contract transactions from.</span>
<span class="sd">            tx: Transaction ID of the contract creation.&quot;&quot;&quot;</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">_find_contract</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contract</span><span class="p">,</span> <span class="n">ProjectContract</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">and</span> <span class="n">contract</span><span class="o">.</span><span class="n">_project</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">contract</span>
            <span class="k">raise</span> <span class="n">ContractExists</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">contract</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; declared at </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2"> in project &#39;</span><span class="si">{</span><span class="n">contract</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="n">build</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">ProjectContract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_verify_deployed_code</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">build</span><span class="p">[</span><span class="s2">&quot;deployedBytecode&quot;</span><span class="p">],</span> <span class="n">build</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]):</span>
            <span class="c1"># prevent trace attempts when the bytecode doesn&#39;t match</span>
            <span class="k">del</span> <span class="n">contract</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;pcMap&quot;</span><span class="p">]</span>

        <span class="n">contract</span><span class="o">.</span><span class="n">_save_deployment</span><span class="p">()</span>
        <span class="n">_add_contract</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contracts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">network_type</span> <span class="o">==</span> <span class="s2">&quot;live&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
                <span class="n">_add_deployment</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">contract</span>

    <span class="k">def</span> <span class="nf">_add_from_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="n">TransactionReceiptType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tx</span><span class="o">.</span><span class="n">_confirmed</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tx</span><span class="o">.</span><span class="n">status</span> <span class="ow">and</span> <span class="n">tx</span><span class="o">.</span><span class="n">contract_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">tx</span><span class="o">.</span><span class="n">contract_address</span><span class="p">,</span> <span class="n">tx</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ContractNotFound</span><span class="p">:</span>
                <span class="c1"># if the contract self-destructed during deployment</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_verification_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dict with flattened source code for this contract</span>
<span class="sd">        and further information needed for verification</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;Vyper&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Etherscan does not support API verification of source code &quot;</span>
                <span class="s2">&quot;for vyper contracts. You need to verify the source manually&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;Solidity&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">source_fp</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;sourcePath&quot;</span><span class="p">])</span>
                    <span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_compiler_config</span>
                <span class="n">remaps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">compiler</span><span class="o">.</span><span class="n">_get_solc_remappings</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;solc&quot;</span><span class="p">][</span><span class="s2">&quot;remappings&quot;</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">libs</span> <span class="o">=</span> <span class="p">{</span><span class="n">lib</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;_{1,}[^_]*_{1,}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)}</span>
                <span class="n">compiler_settings</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;evmVersion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;compiler&quot;</span><span class="p">][</span><span class="s2">&quot;evm_version&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;solc&quot;</span><span class="p">][</span><span class="s2">&quot;optimizer&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;libraries&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">Path</span><span class="p">(</span><span class="n">source_fp</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span><span class="n">lib</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="p">[</span><span class="n">lib</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libs</span><span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span> <span class="o">=</span> <span class="n">Flattener</span><span class="p">(</span><span class="n">source_fp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">remaps</span><span class="p">,</span> <span class="n">compiler_settings</span><span class="p">)</span>

            <span class="n">build_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;standard_json_input&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span><span class="o">.</span><span class="n">standard_input_json</span><span class="p">,</span>
                <span class="s2">&quot;contract_name&quot;</span><span class="p">:</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;contractName&quot;</span><span class="p">],</span>
                <span class="s2">&quot;compiler_version&quot;</span><span class="p">:</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;compiler&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
                <span class="s2">&quot;optimizer_enabled&quot;</span><span class="p">:</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;compiler&quot;</span><span class="p">][</span><span class="s2">&quot;optimizer&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">],</span>
                <span class="s2">&quot;optimizer_runs&quot;</span><span class="p">:</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;compiler&quot;</span><span class="p">][</span><span class="s2">&quot;optimizer&quot;</span><span class="p">][</span><span class="s2">&quot;runs&quot;</span><span class="p">],</span>
                <span class="s2">&quot;license_identifier&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span><span class="o">.</span><span class="n">license</span><span class="p">,</span>
                <span class="s2">&quot;bytecode_len&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;bytecode&quot;</span><span class="p">]),</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported language for source verification: </span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">publish_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten contract and publish source on the selected explorer&quot;&quot;&quot;</span>

        <span class="c1"># Check required conditions for verifying</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;explorer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Explorer API not set for this network&quot;</span><span class="p">)</span>
        <span class="n">env_token</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_explorer_tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">url</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Publishing source is only supported on </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_explorer_tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
                <span class="s2">&quot;change the Explorer API&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_token</span><span class="p">):</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_token</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="p">[</span><span class="n">host</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;An API token is required to verify contract source code. Visit https://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">/ &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;to obtain a token, and then store it as the environment variable $</span><span class="si">{</span><span class="n">env_token</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>

        <span class="c1"># Get source code and contract/compiler information</span>
        <span class="n">contract_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_verification_info</span><span class="p">()</span>

        <span class="c1"># Select matching license code (https://etherscan.io/contract-license-types)</span>
        <span class="n">license_code</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="n">contract_info</span><span class="p">[</span><span class="s2">&quot;license_identifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;unlicensed&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="s2">&quot;mit&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="s2">&quot;agpl&quot;</span> <span class="ow">in</span> <span class="n">identifier</span> <span class="ow">and</span> <span class="s2">&quot;3.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">13</span>
        <span class="k">elif</span> <span class="s2">&quot;lgpl&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;2.1&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
                <span class="n">license_code</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="k">elif</span> <span class="s2">&quot;3.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
                <span class="n">license_code</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">elif</span> <span class="s2">&quot;gpl&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;2.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
                <span class="n">license_code</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="s2">&quot;3.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
                <span class="n">license_code</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="s2">&quot;bsd-2-clause&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="k">elif</span> <span class="s2">&quot;bsd-3-clause&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="k">elif</span> <span class="s2">&quot;mpl&quot;</span> <span class="ow">in</span> <span class="n">identifier</span> <span class="ow">and</span> <span class="s2">&quot;2.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="n">identifier</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;osl&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;3.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="k">elif</span> <span class="s2">&quot;apache&quot;</span> <span class="ow">in</span> <span class="n">identifier</span> <span class="ow">and</span> <span class="s2">&quot;2.0&quot;</span> <span class="ow">in</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">license_code</span> <span class="o">=</span> <span class="mi">12</span>

        <span class="c1"># get constructor arguments</span>
        <span class="n">params_tx</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
            <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;account&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;txlist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span>
            <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;asc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params_tx</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">REQUEST_HEADERS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> when querying </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Constructor arguments received</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Wait for contract to be recognized by etherscan</span>
                <span class="c1"># This takes a few seconds after the contract is deployed</span>
                <span class="c1"># After 10 loops we throw with the API result message (includes address)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API request failed with: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waiting for </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> to process contract...&quot;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="n">constructor_arguments</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input&quot;</span><span class="p">][</span><span class="n">contract_info</span><span class="p">[</span><span class="s2">&quot;bytecode_len&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constructor_arguments</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Submit verification</span>
        <span class="n">payload_verification</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
            <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;contract&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;verifysourcecode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contractaddress&quot;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span>
            <span class="s2">&quot;sourceCode&quot;</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span><span class="o">.</span><span class="n">standard_input_json</span><span class="p">)),</span>
            <span class="s2">&quot;codeformat&quot;</span><span class="p">:</span> <span class="s2">&quot;solidity-standard-json-input&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contractname&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span><span class="o">.</span><span class="n">contract_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_flattener</span><span class="o">.</span><span class="n">contract_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compilerversion&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">contract_info</span><span class="p">[</span><span class="s1">&#39;compiler_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;optimizationUsed&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">contract_info</span><span class="p">[</span><span class="s2">&quot;optimizer_enabled&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;runs&quot;</span><span class="p">:</span> <span class="n">contract_info</span><span class="p">[</span><span class="s2">&quot;optimizer_runs&quot;</span><span class="p">],</span>
            <span class="s2">&quot;constructorArguements&quot;</span><span class="p">:</span> <span class="n">constructor_arguments</span><span class="p">,</span>
            <span class="s2">&quot;licenseType&quot;</span><span class="p">:</span> <span class="n">license_code</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload_verification</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">REQUEST_HEADERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> when querying </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to submit verification request: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Status of request</span>
        <span class="n">guid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verification submitted successfully. Waiting for result...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">params_status</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
            <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;contract&quot;</span><span class="p">,</span>
            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;checkverifystatus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;guid&quot;</span><span class="p">:</span> <span class="n">guid</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params_status</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">REQUEST_HEADERS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> when querying </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pending in queue&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verification pending...&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;bright green&quot;</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OK&quot;</span> <span class="k">else</span> <span class="s2">&quot;bright red&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verification complete. Result: </span><span class="si">{</span><span class="n">color</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="si">}{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OK&quot;</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_slice_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slice the source of the contract, preserving any comments above the first line.&quot;&quot;&quot;</span>
        <span class="n">offset_start</span> <span class="o">=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">top_source</span> <span class="o">=</span> <span class="n">source</span><span class="p">[:</span><span class="n">offset_start</span><span class="p">]</span>
        <span class="n">top_lines</span> <span class="o">=</span> <span class="n">top_source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">comment_open</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">top_lines</span><span class="p">:</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">stripped</span>
                <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;//&quot;</span><span class="p">,</span> <span class="s2">&quot;/*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span>
                <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*/&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">comment_open</span>
            <span class="p">):</span>
                <span class="n">offset_start</span> <span class="o">=</span> <span class="n">offset_start</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*/&quot;</span><span class="p">):</span>
                    <span class="n">comment_open</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/*&quot;</span><span class="p">):</span>
                    <span class="n">comment_open</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Stop on the first non-empty, non-comment line</span>
                <span class="k">break</span>
        <span class="n">offset_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">source</span><span class="p">[</span><span class="n">offset_start</span> <span class="p">:</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ContractConstructor</span><span class="p">:</span>
    <span class="n">_dir_color</span> <span class="o">=</span> <span class="s2">&quot;bright magenta&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="s2">&quot;ContractContainer&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">abi</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constructor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;constructor&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;constructor&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;constructor&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">payable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;payable&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;payable&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;stateMutability&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;payable&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">.constructor(</span><span class="si">{</span><span class="n">_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span><span class="si">}</span><span class="s2">)&#39;&gt;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">publish_source</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Contract&quot;</span><span class="p">,</span> <span class="n">TransactionReceiptType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deploys a contract.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Constructor arguments. The last argument MUST be a dictionary</span>
<span class="sd">                   of transaction values containing at minimum a &#39;from&#39; key to</span>
<span class="sd">                   specify which account to deploy this contract from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            * Contract instance if the transaction confirms</span>
<span class="sd">            * TransactionReceipt if the transaction is pending or reverts&quot;&quot;&quot;</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">_get_tx</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Final argument must be a dict of transaction parameters that &quot;</span>
                <span class="s2">&quot;includes a `from` field specifying the address to deploy from&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="n">gas_limit</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">],</span>
            <span class="n">gas_price</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gas_price&quot;</span><span class="p">),</span>
            <span class="n">max_fee</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_fee&quot;</span><span class="p">),</span>
            <span class="n">priority_fee</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority_fee&quot;</span><span class="p">),</span>
            <span class="n">nonce</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;nonce&quot;</span><span class="p">],</span>
            <span class="n">required_confs</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;required_confs&quot;</span><span class="p">],</span>
            <span class="n">allow_revert</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;allow_revert&quot;</span><span class="p">),</span>
            <span class="n">publish_source</span><span class="o">=</span><span class="n">publish_source</span><span class="p">,</span>
            <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_autosuggest</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="s2">&quot;ContractConstructor&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_contract_method_autosuggest</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">payable</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">bytecode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">bytecode</span>
        <span class="c1"># find and replace unlinked library pointers in bytecode</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;_{1,}[^_]*_{1,}&quot;</span><span class="p">,</span> <span class="n">bytecode</span><span class="p">):</span>
            <span class="n">library</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_project</span><span class="p">[</span><span class="n">library</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">UndeployedLibrary</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Contract requires &#39;</span><span class="si">{</span><span class="n">library</span><span class="si">}</span><span class="s2">&#39; library, but it has not been deployed yet&quot;</span>
                <span class="p">)</span>
            <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_project</span><span class="p">[</span><span class="n">library</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address</span><span class="p">[</span><span class="o">-</span><span class="mi">40</span><span class="p">:]</span>
            <span class="n">bytecode</span> <span class="o">=</span> <span class="n">bytecode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">format_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">bytecode</span> <span class="o">+</span> <span class="n">eth_abi</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">types_list</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">estimate_gas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the gas cost for the deployment.</span>

<span class="sd">        Raises VirtualMachineError if the transaction would revert.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Constructor arguments. The last argument MUST be a dictionary</span>
<span class="sd">            of transaction values containing at minimum a &#39;from&#39; key to</span>
<span class="sd">            specify which account to deploy this contract from.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Estimated gas value in wei.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">_get_tx</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Final argument must be a dict of transaction parameters that &quot;</span>
                <span class="s2">&quot;includes a `from` field specifying the sender of the transaction&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">InterfaceContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container class that provides access to interfaces within a project.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project</span> <span class="o">=</span> <span class="n">project</span>

        <span class="c1"># automatically populate with interfaces in `data/interfaces`</span>
        <span class="c1"># overwritten if a project contains an interface with the same name</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">BROWNIE_FOLDER</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;data/interfaces/*.json&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">abi</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">abi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">abi</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">constructor</span> <span class="o">=</span> <span class="n">InterfaceConstructor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">abi</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">constructor</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InterfaceConstructor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor used to create Contract objects from a project interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">abi</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="o">=</span> <span class="n">abi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">build_function_selector</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Contract&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Contract</span><span class="o">.</span><span class="n">from_abi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">persist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39;&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">decode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calldata</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode input calldata for this contract.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        calldata : str | bytes</span>
<span class="sd">            Calldata for a call to this contract</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Signature of the function that was called</span>
<span class="sd">        Any</span>
<span class="sd">            Decoded input arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">calldata</span><span class="p">,</span> <span class="n">HexBytes</span><span class="p">):</span>
            <span class="n">calldata</span> <span class="o">=</span> <span class="n">HexBytes</span><span class="p">(</span><span class="n">calldata</span><span class="p">)</span>

        <span class="n">fn_selector</span> <span class="o">=</span> <span class="n">calldata</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="n">abi</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">i</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="ow">and</span> <span class="n">build_function_selector</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">fn_selector</span>
            <span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">abi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Four byte selector does not match the ABI for this contract&quot;</span><span class="p">)</span>

        <span class="n">function_sig</span> <span class="o">=</span> <span class="n">build_function_signature</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>

        <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">eth_abi</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">types_list</span><span class="p">,</span> <span class="n">calldata</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="n">input_args</span> <span class="o">=</span> <span class="n">format_input</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">function_sig</span><span class="p">,</span> <span class="n">input_args</span>


<span class="k">class</span> <span class="nc">_DeployedContractBase</span><span class="p">(</span><span class="n">_ContractBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Methods for interacting with a deployed contract.</span>

<span class="sd">    Each public contract method is available as a ContractCall or ContractTx</span>
<span class="sd">    instance, created when this class is instantiated.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        bytecode: Bytecode of the deployed contract, including constructor args.</span>
<span class="sd">        tx: TransactionReceipt of the of the tx that deployed the contract.&quot;&quot;&quot;</span>

    <span class="n">_reverted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="n">TransactionReceiptType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ContractNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No contract deployed at </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">ContractEvents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">_add_deployment_topics</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span>

        <span class="n">fn_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">abi</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">abi</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">build_function_signature</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>
            <span class="n">natspec</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;natspec&quot;</span><span class="p">):</span>
                <span class="n">natspec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;natspec&quot;</span><span class="p">][</span><span class="s2">&quot;methods&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="p">{})</span>

            <span class="k">if</span> <span class="n">fn_names</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">_get_method_object</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">natspec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_and_set</span><span class="p">(</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">fn</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># special logic to handle function overloading</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abi</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span>
                <span class="n">overloaded</span> <span class="o">=</span> <span class="n">OverloadedMethod</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_and_set</span><span class="p">(</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">overloaded</span><span class="p">)</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abi</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">_add_fn</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="n">natspec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_check_and_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;balance&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; defines a &#39;balance&#39; function, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">.balance&#39; is available as </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">.wei_balance&quot;</span><span class="p">,</span>
                <span class="n">BrownieEnvironmentWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;wei_balance&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Namespace collision between contract function and &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;brownie `Contract` class member: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> function will not be available when interacting with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">BrownieEnvironmentWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alias&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alias</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;&#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; Contract &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">&#39;&gt;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2"> Contract &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">&#39;&gt;&quot;</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_DeployedContractBase</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">address</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bytecode</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">address</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;_reverted&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ContractNotFound</span><span class="p">(</span><span class="s2">&quot;This contract no longer exists.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contract &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">_ContractMethod</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is a contract function, it cannot be assigned to&quot;</span>
                <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_method_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calldata</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;_ContractMethod&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a calldata hex string, returns a `ContractMethod` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">calldata</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sig</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectors</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectors</span><span class="p">[</span><span class="n">sig</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">OverloadedMethod</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fn</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">signature</span> <span class="o">==</span> <span class="n">sig</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span>

    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Wei</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the current ether balance of the contract, in wei.&quot;&quot;&quot;</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_balance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Wei</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deployment_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_path</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">CONFIG</span><span class="o">.</span><span class="n">network_type</span> <span class="o">!=</span> <span class="s2">&quot;live&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;dev_deployment_artifacts&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">chainid</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="p">[</span><span class="s2">&quot;chainid&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">network_type</span> <span class="o">==</span> <span class="s2">&quot;live&quot;</span> <span class="k">else</span> <span class="s2">&quot;dev&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_build_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;deployments/</span><span class="si">{</span><span class="n">chainid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deployment_path</span><span class="p">()</span>
        <span class="n">chainid</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="p">[</span><span class="s2">&quot;chainid&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">network_type</span> <span class="o">==</span> <span class="s2">&quot;live&quot;</span> <span class="k">else</span> <span class="s2">&quot;dev&quot;</span>
        <span class="n">deployment_build</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">deployment_build</span><span class="p">[</span><span class="s2">&quot;deployment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s2">&quot;chainid&quot;</span><span class="p">:</span> <span class="n">chainid</span><span class="p">,</span>
            <span class="s2">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_add_to_deployment_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">deployment_build</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deployment_path</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_remove_from_deployment_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Contract</span><span class="p">(</span><span class="n">_DeployedContractBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object to interact with a deployed contract outside of a project.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">address_or_alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recreate a `Contract` object from the local database.</span>

<span class="sd">        The init method is used to access deployments that have already previously</span>
<span class="sd">        been stored locally. For new deployments use `from_abi` or `from_etherscan`.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        address_or_alias : str</span>
<span class="sd">            Address or user-defined alias of the deployment.</span>
<span class="sd">        owner : Account, optional</span>
<span class="sd">            Contract owner. If set, transactions without a `from` field</span>
<span class="sd">            will be performed using this account.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">address_or_alias</span> <span class="o">=</span> <span class="n">address_or_alias</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Initializing `Contract` in this manner is deprecated.&quot;</span> <span class="s2">&quot; Use `from_abi` instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;owner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">owner</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deprecated_init</span><span class="p">(</span><span class="n">address_or_alias</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">address_or_alias</span><span class="p">)</span>
            <span class="n">build</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="n">_get_deployment</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">build</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="n">_get_deployment</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="n">address_or_alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">build</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">address</span> <span class="o">=</span> <span class="n">build</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">build</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">sources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">address</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;autofetch_sources&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;explorer&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown alias: &#39;</span><span class="si">{</span><span class="n">address_or_alias</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown contract address: &#39;</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_explorer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="n">owner</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">build</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">_build</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">_sources</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">address</span>

        <span class="n">_ContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span>
        <span class="n">_DeployedContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deprecated_init</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">abi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">manifest_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">manifest_uri</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ethPM functionality removed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Address cannot be None unless creating object from manifest&quot;</span><span class="p">)</span>

        <span class="n">build</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;abi&quot;</span><span class="p">:</span> <span class="n">abi</span><span class="p">,</span> <span class="s2">&quot;contractName&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;contract&quot;</span><span class="p">}</span>
        <span class="n">_ContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># type: ignore</span>
        <span class="n">_DeployedContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_abi</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">abi</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">persist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Contract&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new `Contract` object from an ABI.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the contract.</span>
<span class="sd">        address : str</span>
<span class="sd">            Address where the contract is deployed.</span>
<span class="sd">        abi : dict</span>
<span class="sd">            Contract ABI, given as a dictionary.</span>
<span class="sd">        owner : Account, optional</span>
<span class="sd">            Contract owner. If set, transactions without a `from` field</span>
<span class="sd">            will be performed using this account.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">build</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;abi&quot;</span><span class="p">:</span> <span class="n">abi</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span> <span class="s2">&quot;contractName&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;contract&quot;</span><span class="p">}</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">_ContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># type: ignore</span>
        <span class="n">_DeployedContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
            <span class="n">_add_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_explorer</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">as_proxy_for</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">persist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Contract&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new `Contract` object with source code queried from a block explorer.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        address : str</span>
<span class="sd">            Address where the contract is deployed.</span>
<span class="sd">        as_proxy_for : str, optional</span>
<span class="sd">            Address of the implementation contract, if `address` is a proxy contract.</span>
<span class="sd">            The generated object will send transactions to `address`, but use the ABI</span>
<span class="sd">            and NatSpec of `as_proxy_for`. This field is only required when the</span>
<span class="sd">            block explorer API does not provide an implementation address.</span>
<span class="sd">        owner : Account, optional</span>
<span class="sd">            Contract owner. If set, transactions without a `from` field will be</span>
<span class="sd">            performed using this account.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_fetch_from_explorer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="s2">&quot;getsourcecode&quot;</span><span class="p">,</span> <span class="n">silent</span><span class="p">)</span>
        <span class="n">is_verified</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SourceCode&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_verified</span><span class="p">:</span>
            <span class="n">abi</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;ABI&quot;</span><span class="p">])</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;ContractName&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if the source is not available, try to fetch only the ABI</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data_abi</span> <span class="o">=</span> <span class="n">_fetch_from_explorer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="s2">&quot;getabi&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_unverified_addresses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">exc</span>
            <span class="n">abi</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data_abi</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;UnknownContractName&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">: Was able to fetch the ABI but not the source code. &quot;</span>
                    <span class="s2">&quot;Some functionality will not be available.&quot;</span><span class="p">,</span>
                    <span class="n">BrownieCompilerWarning</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">as_proxy_for</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># always check for an EIP1967 proxy - https://eips.ethereum.org/EIPS/eip-1967</span>
            <span class="n">implementation_eip1967</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_storage_at</span><span class="p">(</span>
                <span class="n">address</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">web3</span><span class="o">.</span><span class="n">keccak</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;eip1967.proxy.implementation&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="c1"># always check for an EIP1822 proxy - https://eips.ethereum.org/EIPS/eip-1822</span>
            <span class="n">implementation_eip1822</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_storage_at</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">web3</span><span class="o">.</span><span class="n">keccak</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;PROXIABLE&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">implementation_eip1967</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">implementation_eip1967</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span> <span class="mi">16</span><span class="p">):</span>
                <span class="n">as_proxy_for</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">implementation_eip1967</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">implementation_eip1822</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">implementation_eip1822</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span> <span class="mi">16</span><span class="p">):</span>
                <span class="n">as_proxy_for</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">implementation_eip1822</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:])</span>
            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Implementation&quot;</span><span class="p">):</span>
                <span class="c1"># for other proxy patterns, we only check if etherscan indicates</span>
                <span class="c1"># the contract is a proxy. otherwise we could have a false positive</span>
                <span class="c1"># if there is an `implementation` method on a regular contract.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># first try to call `implementation` per EIP897</span>
                    <span class="c1"># https://eips.ethereum.org/EIPS/eip-897</span>
                    <span class="n">contract</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_abi</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">)</span>
                    <span class="n">as_proxy_for</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># if that fails, fall back to the address provided by etherscan</span>
                    <span class="n">as_proxy_for</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Implementation&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">as_proxy_for</span> <span class="o">==</span> <span class="n">address</span><span class="p">:</span>
            <span class="n">as_proxy_for</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># if this is a proxy, fetch information for the implementation contract</span>
        <span class="k">if</span> <span class="n">as_proxy_for</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">implementation_contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="o">.</span><span class="n">from_explorer</span><span class="p">(</span><span class="n">as_proxy_for</span><span class="p">)</span>
            <span class="n">abi</span> <span class="o">=</span> <span class="n">implementation_contract</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;abi&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_verified</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_abi</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>

        <span class="n">compiler_str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;CompilerVersion&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">compiler_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;vyper:&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">to_vyper_version</span><span class="p">(</span><span class="n">compiler_str</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
                <span class="n">is_compilable</span> <span class="o">=</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">get_installable_vyper_versions</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">is_compilable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_solc_version</span><span class="p">(</span><span class="n">compiler_str</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

                <span class="n">is_compilable</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">version</span> <span class="o">&gt;=</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;0.4.22&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">version</span>
                    <span class="ow">in</span> <span class="n">solcx</span><span class="o">.</span><span class="n">get_installable_solc_versions</span><span class="p">()</span> <span class="o">+</span> <span class="n">solcx</span><span class="o">.</span><span class="n">get_installed_solc_versions</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">is_compilable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_compilable</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">: target compiler &#39;</span><span class="si">{</span><span class="n">compiler_str</span><span class="si">}</span><span class="s2">&#39; cannot be installed or is not &quot;</span>
                    <span class="s2">&quot;supported by Brownie. Some debugging functionality will not be available.&quot;</span><span class="p">,</span>
                    <span class="n">BrownieCompilerWarning</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_abi</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;OptimizationUsed&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Blockscout explorer API has limited support by Brownie. &quot;</span>  <span class="c1"># noqa</span>
                    <span class="s2">&quot;Some debugging functionality will not be available.&quot;</span><span class="p">,</span>
                    <span class="n">BrownieCompilerWarning</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_abi</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>

        <span class="n">optimizer</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;OptimizationUsed&quot;</span><span class="p">])),</span>
            <span class="s2">&quot;runs&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Runs&quot;</span><span class="p">]),</span>
        <span class="p">}</span>
        <span class="n">evm_version</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EVMVersion&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">evm_version</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
            <span class="n">evm_version</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">source_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;SourceCode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{{&quot;</span><span class="p">):</span>
                <span class="c1"># source was verified using compiler standard JSON</span>
                <span class="n">input_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">source_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">sources</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">input_json</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">evm_version</span> <span class="o">=</span> <span class="n">input_json</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;evmVersion&quot;</span><span class="p">,</span> <span class="n">evm_version</span><span class="p">)</span>
                <span class="n">remappings</span> <span class="o">=</span> <span class="n">input_json</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remappings&quot;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="n">compiler</span><span class="o">.</span><span class="n">set_solc_version</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">))</span>
                <span class="n">input_json</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">compiler</span><span class="o">.</span><span class="n">generate_input_json</span><span class="p">(</span>
                        <span class="n">sources</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">evm_version</span><span class="o">=</span><span class="n">evm_version</span><span class="p">,</span> <span class="n">remappings</span><span class="o">=</span><span class="n">remappings</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">output_json</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile_from_input_json</span><span class="p">(</span><span class="n">input_json</span><span class="p">)</span>
                <span class="n">build_json</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">generate_build_json</span><span class="p">(</span><span class="n">input_json</span><span class="p">,</span> <span class="n">output_json</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">source_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">):</span>
                    <span class="c1"># source was submitted as multiple files</span>
                    <span class="n">sources</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">source_str</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># source was submitted as a single file</span>
                    <span class="k">if</span> <span class="n">compiler_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;vyper&quot;</span><span class="p">):</span>
                        <span class="n">path_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.vy&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">path_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-flattened.sol&quot;</span>
                    <span class="n">sources</span> <span class="o">=</span> <span class="p">{</span><span class="n">path_str</span><span class="p">:</span> <span class="n">source_str</span><span class="p">}</span>

                <span class="n">build_json</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile_and_format</span><span class="p">(</span>
                    <span class="n">sources</span><span class="p">,</span>
                    <span class="n">solc_version</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">),</span>
                    <span class="n">vyper_version</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">),</span>
                    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                    <span class="n">evm_version</span><span class="o">=</span><span class="n">evm_version</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">: Compilation failed due to </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. Falling back to ABI,&quot;</span>
                    <span class="s2">&quot; some functionality will not be available.&quot;</span><span class="p">,</span>
                    <span class="n">BrownieCompilerWarning</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_abi</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>

        <span class="n">build_json</span> <span class="o">=</span> <span class="n">build_json</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">as_proxy_for</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">build_json</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">abi</span><span class="o">=</span><span class="n">abi</span><span class="p">,</span> <span class="n">natspec</span><span class="o">=</span><span class="n">implementation_contract</span><span class="o">.</span><span class="n">_build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;natspec&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_verify_deployed_code</span><span class="p">(</span>
            <span class="n">address</span><span class="p">,</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;deployedBytecode&quot;</span><span class="p">],</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">: Locally compiled and on-chain bytecode do not match!&quot;</span><span class="p">,</span>
                    <span class="n">BrownieCompilerWarning</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">del</span> <span class="n">build_json</span><span class="p">[</span><span class="s2">&quot;pcMap&quot;</span><span class="p">]</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">_ContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build_json</span><span class="p">,</span> <span class="n">sources</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">_DeployedContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
            <span class="n">_add_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Contract.get_solc_version">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.Contract.get_solc_version">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_solc_version</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compiler_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the solc compiler version either from the passed compiler string</span>
<span class="sd">        or try to find the latest available patch semver compiler version.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        compiler_str: str</span>
<span class="sd">            The compiler string passed from the contract metadata.</span>
<span class="sd">        address: str</span>
<span class="sd">            The contract address to check for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">Version</span><span class="p">(</span><span class="n">compiler_str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

        <span class="n">compiler_config</span> <span class="o">=</span> <span class="n">_load_project_compiler_config</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
        <span class="n">solc_config</span> <span class="o">=</span> <span class="n">compiler_config</span><span class="p">[</span><span class="s2">&quot;solc&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;use_latest_patch&quot;</span> <span class="ow">in</span> <span class="n">solc_config</span><span class="p">:</span>
            <span class="n">use_latest_patch</span> <span class="o">=</span> <span class="n">solc_config</span><span class="p">[</span><span class="s2">&quot;use_latest_patch&quot;</span><span class="p">]</span>
            <span class="n">needs_patch_version</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_latest_patch</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">needs_patch_version</span> <span class="o">=</span> <span class="n">use_latest_patch</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_latest_patch</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">needs_patch_version</span> <span class="o">=</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">use_latest_patch</span>

            <span class="k">if</span> <span class="n">needs_patch_version</span><span class="p">:</span>
                <span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">Version</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">solcx</span><span class="o">.</span><span class="n">get_installable_solc_versions</span><span class="p">()]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">next_minor</span><span class="p">(),</span> <span class="n">versions</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">version</span><span class="p">:</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="n">version</span></div>


<div class="viewcode-block" id="Contract.remove_deployment">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.Contract.remove_deployment">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove_deployment</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes this contract from the internal deployments db</span>
<span class="sd">        with the passed address or alias.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        address: str | None</span>
<span class="sd">            An address to apply</span>
<span class="sd">        alias: str | None</span>
<span class="sd">            An alias to apply</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_remove_deployment</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span></div>


<div class="viewcode-block" id="Contract.set_alias">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.Contract.set_alias">[docs]</a>
    <span class="k">def</span> <span class="nf">set_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">persist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a unique alias this object. The alias can be used to restore the</span>
<span class="sd">        object in future sessions.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        alias: str | None</span>
<span class="sd">            An alias to apply. If `None`, any existing alias is removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;chainid&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot set aliases in a development environment&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">alias</span> <span class="ow">or</span> <span class="n">alias</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid alias&quot;</span><span class="p">)</span>
            <span class="n">build</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_deployment</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">build</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">build</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alias is already in use on another contract&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
            <span class="n">_add_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alias</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alias</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alias&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProjectContract</span><span class="p">(</span><span class="n">_DeployedContractBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Methods for interacting with a deployed contract as part of a Brownie project.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">build</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tx</span><span class="p">:</span> <span class="n">TransactionReceiptType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_ContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">_sources</span><span class="p">)</span>
        <span class="n">_DeployedContractBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ContractEvents</span><span class="p">(</span><span class="n">_ContractEvents</span><span class="p">):</span>
<div class="viewcode-block" id="ContractEvents.__init__">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.ContractEvents.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">_DeployedContractBase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linked_contract</span> <span class="o">=</span> <span class="n">contract</span>

        <span class="c1"># Ignoring type since ChecksumAddress type is an alias for string</span>
        <span class="n">_ContractEvents</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">abi</span><span class="p">,</span> <span class="n">web3</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="ContractEvents.subscribe">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.ContractEvents.subscribe">[docs]</a>
    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">AttributeDict</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe to event with a name matching &#39;event_name&#39;, calling the &#39;callback&#39;</span>
<span class="sd">        function on new occurrence giving as parameter the event log receipt.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_name (str): Name of the event to subscribe to.</span>
<span class="sd">            callback (Callable[[AttributeDict], None]): Function called whenever an event occurs.</span>
<span class="sd">            delay (float, optional): Delay between each check for new events. Defaults to 2.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_event</span><span class="p">:</span> <span class="n">ContractEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">event_watcher</span><span class="o">.</span><span class="n">add_event_callback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">target_event</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">)</span></div>


<div class="viewcode-block" id="ContractEvents.get_sequence">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.ContractEvents.get_sequence">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sequence</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">from_block</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">to_block</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ContractEvent</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AttributeDict</span><span class="p">],</span> <span class="n">AttributeDict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the logs of events of type &#39;event_type&#39; that occurred between the</span>
<span class="sd">        blocks &#39;from_block&#39; and &#39;to_block&#39;. If &#39;event_type&#39; is not specified,</span>
<span class="sd">        it retrieves the occurrences of all events in the contract.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_block (int): The block from which to search for events that have occurred.</span>
<span class="sd">            to_block (int, optional): The block on which to stop searching for events.</span>
<span class="sd">            if not specified, it is set to the most recently mined block (web3.eth.block_number).</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            event_type (ContractEvent, str, optional): Type or name of the event to be searched</span>
<span class="sd">            between the specified blocks. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            if &#39;event_type&#39; is specified:</span>
<span class="sd">                [list]: List of events of type &#39;event_type&#39; that occurred between</span>
<span class="sd">                &#39;from_block&#39; and &#39;to_block&#39;.</span>
<span class="sd">            else:</span>
<span class="sd">                event_logbook [dict]: Dictionary of events of the contract that occurred</span>
<span class="sd">                between &#39;from_block&#39; and &#39;to_block&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">to_block</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">to_block</span> <span class="o">&gt;</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span><span class="p">:</span>
            <span class="n">to_block</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span>

        <span class="c1"># Returns event sequence for the specified event</span>
        <span class="k">if</span> <span class="n">event_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># If &#39;event_type&#39; is a string, search for an event with a name matching it.</span>
                <span class="n">event_type</span><span class="p">:</span> <span class="n">ContractEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">event_type</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_contract_events</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">from_block</span><span class="p">,</span> <span class="n">to_block</span><span class="p">)</span>

        <span class="c1"># Returns event sequence for all contract events</span>
        <span class="n">events_logbook</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">ContractEvents</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">events_logbook</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">event_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_contract_events</span><span class="p">(</span>
                <span class="n">event</span><span class="p">,</span> <span class="n">from_block</span><span class="p">,</span> <span class="n">to_block</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">AttributeDict</span><span class="p">(</span><span class="n">events_logbook</span><span class="p">)</span></div>


<div class="viewcode-block" id="ContractEvents.listen">
<a class="viewcode-back" href="../../../source/y.html#y.contracts.ContractEvents.listen">[docs]</a>
    <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Coroutine</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a listening Coroutine object ending whenever an event matching</span>
<span class="sd">        &#39;event_name&#39; occurs. If timeout is superior to zero and no event matching</span>
<span class="sd">        &#39;event_name&#39; has occured, the Coroutine ends when the timeout is reached.</span>

<span class="sd">        The Coroutine return value is an AttributeDict filled with the following fields :</span>
<span class="sd">            - &#39;event_data&#39; (AttributeDict): The event log receipt that was caught.</span>
<span class="sd">            - &#39;timed_out&#39; (bool): False if the event did not timeout, else True</span>

<span class="sd">        If the &#39;timeout&#39; parameter is not passed or is inferior or equal to 0,</span>
<span class="sd">        the Coroutine listens indefinitely.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_name (str): Name of the event to be listened to.</span>
<span class="sd">            timeout (float, optional): Timeout value in seconds. Defaults to 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Coroutine: Awaitable object listening for the event matching &#39;event_name&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_triggered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_received_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AttributeDict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">_event_callback</span><span class="p">(</span><span class="n">event_data</span><span class="p">:</span> <span class="n">AttributeDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Fills the nonlocal varialbe &#39;_received_data&#39; with the received</span>
<span class="sd">            argument &#39;event_data&#39; and sets the nonlocal &#39;_triggered&#39; variable to True</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="n">_triggered</span><span class="p">,</span> <span class="n">_received_data</span>
            <span class="n">_received_data</span> <span class="o">=</span> <span class="n">event_data</span>
            <span class="n">_triggered</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">_listener_end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">_listening_task</span><span class="p">(</span><span class="n">is_timeout</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AttributeDict</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generates and returns a coroutine listening for an event&quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="n">_triggered</span><span class="p">,</span> <span class="n">_received_data</span>
            <span class="n">timed_out</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="n">_triggered</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_timeout</span> <span class="ow">and</span> <span class="n">end_time</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                    <span class="n">timed_out</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">AttributeDict</span><span class="p">({</span><span class="s2">&quot;event_data&quot;</span><span class="p">:</span> <span class="n">_received_data</span><span class="p">,</span> <span class="s2">&quot;timed_out&quot;</span><span class="p">:</span> <span class="n">timed_out</span><span class="p">})</span>

        <span class="n">target_event</span><span class="p">:</span> <span class="n">ContractEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">event_watcher</span><span class="o">.</span><span class="n">add_event_callback</span><span class="p">(</span>
            <span class="n">event</span><span class="o">=</span><span class="n">target_event</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_event_callback</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">_listening_task</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">_listener_end_time</span><span class="p">)</span></div>


    <span class="nd">@combomethod</span>
    <span class="k">def</span> <span class="nf">_retrieve_contract_events</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="n">ContractEvent</span><span class="p">,</span> <span class="n">from_block</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">to_block</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LogReceipt</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all log receipts from &#39;event_type&#39; between &#39;from_block&#39; and &#39;to_block&#39; blocks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">to_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_block</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span>
        <span class="k">if</span> <span class="n">from_block</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_block</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">from_block</span> <span class="o">=</span> <span class="n">to_block</span> <span class="o">-</span> <span class="mi">10</span>

        <span class="n">event_filter</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">LogFilter</span> <span class="o">=</span> <span class="n">event_type</span><span class="o">.</span><span class="n">create_filter</span><span class="p">(</span>
            <span class="n">fromBlock</span><span class="o">=</span><span class="n">from_block</span><span class="p">,</span> <span class="n">toBlock</span><span class="o">=</span><span class="n">to_block</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">event_filter</span><span class="o">.</span><span class="n">get_all_entries</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">OverloadedMethod</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natspec</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_add_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abi</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">natspec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">_get_method_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">natspec</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;256&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natspec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">natspec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_fn_from_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;_ContractMethod&quot;</span><span class="p">:</span>
        <span class="n">input_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">input_length</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">input_length</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No function matching the given number of arguments&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Contract has more than one function &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; requiring &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_length</span><span class="si">}</span><span class="s2"> arguments. You must explicitly declare which function &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;you are calling, e.g. </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">[&#39;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39;](*args)&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;_ContractMethod&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;256&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;OverloadedMethod &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39;&gt;&quot;</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">block_identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fn_from_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;block_identifier&quot;</span><span class="p">:</span> <span class="n">block_identifier</span><span class="p">,</span> <span class="s2">&quot;override&quot;</span><span class="p">:</span> <span class="n">override</span><span class="p">}</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">block_identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the contract method without broadcasting a transaction.</span>

<span class="sd">        The specific function called is chosen based on the number of</span>
<span class="sd">        arguments given. If more than one function exists with this number</span>
<span class="sd">        of arguments, a `ValueError` is raised.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs. You can optionally provide a</span>
<span class="sd">            dictionary of transaction properties as the last arg.</span>
<span class="sd">        block_identifier : int | str | bytes, optional</span>
<span class="sd">            A block number or hash that the call is executed at. If not given, the</span>
<span class="sd">            latest block used. Raises `ValueError` if this value is too far in the</span>
<span class="sd">            past and you are not using an archival node.</span>
<span class="sd">        override : dict, optional</span>
<span class="sd">            A mapping from addresses to balance, nonce, code, state, stateDiff</span>
<span class="sd">            overrides for the context of the call.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Contract method return value(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fn_from_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">block_identifier</span><span class="o">=</span><span class="n">block_identifier</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransactionReceiptType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Broadcast a transaction that calls this contract method.</span>

<span class="sd">        The specific function called is chosen based on the number of</span>
<span class="sd">        arguments given. If more than one function exists with this number</span>
<span class="sd">        of arguments, a `ValueError` is raised.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs. You can optionally provide a</span>
<span class="sd">            dictionary of transaction properties as the last arg.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TransactionReceipt</span>
<span class="sd">            Object representing the broadcasted transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fn_from_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate encoded ABI data to call the method with the given arguments.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Hexstring of encoded ABI data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fn_from_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode input call data for this method.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        hexstr : str</span>
<span class="sd">            Hexstring of input call data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Decoded values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">HexBytes</span><span class="p">(</span><span class="n">hexstr</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">selector</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Data cannot be decoded using any input signatures of functions of this name&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">decode_input</span><span class="p">(</span><span class="n">hexstr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode hexstring data returned by this method.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        hexstr : str</span>
<span class="sd">            Hexstring of returned call data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Decoded values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">decode_output</span><span class="p">(</span><span class="n">hexstr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Data cannot be decoded using any output signatures of functions of this name&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display NatSpec documentation for this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fn_sigs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">fn_sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fn</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">_inputs</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fn_sigs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">_print_natspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natspec</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_ContractMethod</span><span class="p">:</span>
    <span class="n">_dir_color</span> <span class="o">=</span> <span class="s2">&quot;bright magenta&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">abi</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">],</span>
        <span class="n">natspec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abi</span> <span class="o">=</span> <span class="n">abi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">build_function_selector</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_sig</span> <span class="o">=</span> <span class="n">build_function_signature</span><span class="p">(</span><span class="n">abi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natspec</span> <span class="o">=</span> <span class="n">natspec</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">pay</span> <span class="o">=</span> <span class="s2">&quot;payable &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">payable</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pay</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span><span class="si">}</span><span class="s2">)&#39;&gt;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">payable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;payable&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;payable&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;stateMutability&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;payable&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_autosuggest</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="s2">&quot;_ContractMethod&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="c1"># this is a staticmethod to be compatible with `_call_suggest` and `_transact_suggest`</span>
        <span class="k">return</span> <span class="n">_contract_method_autosuggest</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">],</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ContractTx</span><span class="p">),</span> <span class="n">obj</span><span class="o">.</span><span class="n">payable</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display NatSpec documentation for this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">_print_natspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natspec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">block_identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the contract method without broadcasting a transaction.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs. You can optionally provide a</span>
<span class="sd">            dictionary of transaction properties as the last arg.</span>
<span class="sd">        block_identifier : int | str | bytes, optional</span>
<span class="sd">            A block number or hash that the call is executed at. If not given, the</span>
<span class="sd">            latest block used. Raises `ValueError` if this value is too far in the</span>
<span class="sd">            past and you are not using an archival node.</span>
<span class="sd">        override : dict, optional</span>
<span class="sd">            A mapping from addresses to balance, nonce, code, state, stateDiff</span>
<span class="sd">            overrides for the context of the call.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Contract method return value(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">args</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">_get_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]:</span>
            <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;required_confs&quot;</span><span class="p">]</span>
        <span class="n">tx</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">call</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tx</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">},</span> <span class="n">block_identifier</span><span class="p">,</span> <span class="n">override</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VirtualMachineError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;outputs&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data was returned - the call likely reverted&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_output</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Call reverted: </span><span class="si">{</span><span class="n">decode_typed_error</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">transact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransactionReceiptType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Broadcast a transaction that calls this contract method.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs. You can optionally provide a</span>
<span class="sd">            dictionary of transaction properties as the last arg.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TransactionReceipt</span>
<span class="sd">            Object representing the broadcasted transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">args</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">_get_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Final argument must be a dict of transaction parameters that &quot;</span>
                <span class="s2">&quot;includes a `from` field specifying the sender of the transaction&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">,</span>
            <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="n">gas_limit</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">],</span>
            <span class="n">gas_buffer</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gas_buffer&quot;</span><span class="p">),</span>
            <span class="n">gas_price</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gas_price&quot;</span><span class="p">),</span>
            <span class="n">max_fee</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_fee&quot;</span><span class="p">),</span>
            <span class="n">priority_fee</span><span class="o">=</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority_fee&quot;</span><span class="p">),</span>
            <span class="n">nonce</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;nonce&quot;</span><span class="p">],</span>
            <span class="n">required_confs</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;required_confs&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span>
            <span class="n">allow_revert</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;allow_revert&quot;</span><span class="p">],</span>
            <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode input call data for this method.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        hexstr : str</span>
<span class="sd">            Hexstring of input call data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Decoded values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">eth_abi</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">types_list</span><span class="p">,</span> <span class="n">HexBytes</span><span class="p">(</span><span class="n">hexstr</span><span class="p">)[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">format_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate encoded ABI data to call the method with the given arguments.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Hexstring of encoded ABI data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">format_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">+</span> <span class="n">eth_abi</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">types_list</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">decode_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode hexstring data returned by this method.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        hexstr : str</span>
<span class="sd">            Hexstring of returned call data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Decoded values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;outputs&quot;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">eth_abi</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">types_list</span><span class="p">,</span> <span class="n">HexBytes</span><span class="p">(</span><span class="n">hexstr</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">format_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abi</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">estimate_gas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the gas cost for a transaction.</span>

<span class="sd">        Raises VirtualMachineError if the transaction would revert.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Estimated gas value in wei.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">_get_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Final argument must be a dict of transaction parameters that &quot;</span>
                <span class="s2">&quot;includes a `from` field specifying the sender of the transaction&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span>
            <span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encode_input</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">ContractTx</span><span class="p">(</span><span class="n">_ContractMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A public payable or non-payable contract method.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    abi : dict</span>
<span class="sd">        Contract ABI specific to this method.</span>
<span class="sd">    signature : str</span>
<span class="sd">        Bytes4 method signature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransactionReceiptType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Broadcast a transaction that calls this contract method.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Contract method inputs. You can optionally provide a</span>
<span class="sd">            dictionary of transaction properties as the last arg.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TransactionReceipt</span>
<span class="sd">            Object representing the broadcasted transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ContractCall</span><span class="p">(</span><span class="n">_ContractMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A public view or pure contract method.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    abi : dict</span>
<span class="sd">        Contract ABI specific to this method.</span>
<span class="sd">    signature : str</span>
<span class="sd">        Bytes4 method signature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">block_identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the contract method without broadcasting a transaction.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        args</span>
<span class="sd">            Contract method inputs. You can optionally provide a</span>
<span class="sd">            dictionary of transaction properties as the last arg.</span>
<span class="sd">        block_identifier : int | str | bytes, optional</span>
<span class="sd">            A block number or hash that the call is executed at. If not given, the</span>
<span class="sd">            latest block used. Raises `ValueError` if this value is too far in the</span>
<span class="sd">            past and you are not using an archival node.</span>
<span class="sd">        override : dict, optional</span>
<span class="sd">            A mapping from addresses to balance, nonce, code, state, stateDiff</span>
<span class="sd">            overrides for the context of the call.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Contract method return value(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="s2">&quot;always_transact&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">block_identifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">block_identifier</span><span class="o">=</span><span class="n">block_identifier</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span>

        <span class="n">args</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">_get_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">tx</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;gas_price&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="ow">or</span> <span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
        <span class="n">pc</span><span class="p">,</span> <span class="n">revert_msg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">VirtualMachineError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">pc</span><span class="p">,</span> <span class="n">revert_msg</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">revert_msg</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">VirtualMachineError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pc</span> <span class="o">==</span> <span class="n">exc</span><span class="o">.</span><span class="n">pc</span> <span class="ow">and</span> <span class="n">revert_msg</span> <span class="ow">and</span> <span class="n">exc</span><span class="o">.</span><span class="n">revert_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># in case we miss a dev revert string</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">revert_msg</span> <span class="o">=</span> <span class="n">revert_msg</span>
            <span class="k">raise</span> <span class="n">exc</span>


<span class="k">def</span> <span class="nf">_get_tx</span><span class="p">(</span><span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">],</span> <span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="c1"># set / remove default sender</span>
    <span class="k">if</span> <span class="n">owner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">default</span>
    <span class="n">default_owner</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;default_contract_owner&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="ow">and</span> <span class="n">default_owner</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># seperate contract inputs from tx dict and set default tx values</span>
    <span class="n">tx</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">owner</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;gas_buffer&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;required_confs&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;allow_revert&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">tx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># key substitution to provide compatibility with web3.py</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;gas_limit&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;gas_price&quot;</span><span class="p">,</span> <span class="s2">&quot;gasPrice&quot;</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tx</span><span class="p">:</span>
                <span class="n">tx</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># enable the magic of ganache&#39;s `evm_unlockUnknownAccount`</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">],</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">],</span> <span class="n">_DeployedContractBase</span><span class="p">):</span>
        <span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accounts</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">tx</span>


<span class="k">def</span> <span class="nf">_get_method_object</span><span class="p">(</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">abi</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccountsType</span><span class="p">],</span> <span class="n">natspec</span><span class="p">:</span> <span class="n">Dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ContractCall&quot;</span><span class="p">,</span> <span class="s2">&quot;ContractTx&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="s2">&quot;constant&quot;</span> <span class="ow">in</span> <span class="n">abi</span><span class="p">:</span>
        <span class="n">constant</span> <span class="o">=</span> <span class="n">abi</span><span class="p">[</span><span class="s2">&quot;constant&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">constant</span> <span class="o">=</span> <span class="n">abi</span><span class="p">[</span><span class="s2">&quot;stateMutability&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;view&quot;</span><span class="p">,</span> <span class="s2">&quot;pure&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">constant</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ContractCall</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">natspec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ContractTx</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">natspec</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_inputs</span><span class="p">(</span><span class="n">abi</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;fixed168x10&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span><span class="p">})</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]],</span> <span class="n">types_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;bright blue&#39;</span><span class="p">)</span><span class="si">}{</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">params</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_verify_deployed_code</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected_bytecode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">actual_bytecode</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">expected_bytecode</span> <span class="o">=</span> <span class="n">remove_0x_prefix</span><span class="p">(</span><span class="n">expected_bytecode</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">if</span> <span class="n">expected_bytecode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;730000000000000000000000000000000000000000&quot;</span><span class="p">):</span>
        <span class="c1"># special case for Solidity libraries</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">actual_bytecode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;73</span><span class="si">{</span><span class="n">address</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">actual_bytecode</span><span class="p">[</span><span class="mi">42</span><span class="p">:]</span> <span class="o">==</span> <span class="n">expected_bytecode</span><span class="p">[</span><span class="mi">42</span><span class="p">:]</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">expected_bytecode</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;_{1,}[^_]*_{1,}&quot;</span><span class="p">,</span> <span class="n">expected_bytecode</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">expected_bytecode</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
            <span class="n">actual_bytecode</span> <span class="o">=</span> <span class="n">actual_bytecode</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">actual_bytecode</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">40</span> <span class="p">:]</span>
            <span class="n">expected_bytecode</span> <span class="o">=</span> <span class="n">expected_bytecode</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">expected_bytecode</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">40</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;Solidity&quot;</span><span class="p">:</span>
        <span class="c1"># do not include metadata in comparison</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">actual_bytecode</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">actual_bytecode</span> <span class="o">=</span> <span class="n">actual_bytecode</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">expected_bytecode</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">expected_bytecode</span> <span class="o">=</span> <span class="n">expected_bytecode</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;Vyper&quot;</span><span class="p">:</span>
        <span class="c1"># don&#39;t check immutables section</span>
        <span class="c1"># TODO actually grab data section length from layout.</span>
        <span class="k">return</span> <span class="n">actual_bytecode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">expected_bytecode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">actual_bytecode</span> <span class="o">==</span> <span class="n">expected_bytecode</span>


<span class="k">def</span> <span class="nf">_print_natspec</span><span class="p">(</span><span class="n">natspec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">wrapper</span> <span class="o">=</span> <span class="n">TextWrapper</span><span class="p">(</span><span class="n">initial_indent</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;bright magenta&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;notice&quot;</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">natspec</span><span class="p">]:</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">subsequent_indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">natspec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">natspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">subsequent_indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">9</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@param </span><span class="si">{</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;bright blue&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">key</span><span class="si">}{</span><span class="n">color</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="s2">&quot;return&quot;</span> <span class="ow">in</span> <span class="n">natspec</span><span class="p">:</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">subsequent_indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@return </span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">natspec</span><span class="p">[</span><span class="s1">&#39;return&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">natspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;returns&quot;</span><span class="p">,</span> <span class="p">[])):</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">subsequent_indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;@return </span><span class="si">{</span><span class="n">color</span><span class="si">}{</span><span class="n">natspec</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_fetch_from_explorer</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">active_network</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;explorer&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Explorer API not set for this network&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">_unverified_addresses</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source for </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2"> has not been verified&quot;</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">web3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c1"># EIP-1167: Minimal Proxy Contract</span>
    <span class="k">if</span> <span class="n">code</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;363d3d373d3d3d363d73&quot;</span> <span class="ow">and</span> <span class="n">code</span><span class="p">[</span><span class="mi">60</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;5af43d82803e903d91602b57fd5bf3&quot;</span><span class="p">:</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">code</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">60</span><span class="p">])</span>
    <span class="c1"># Vyper &lt;0.2.9 `create_forwarder_to`</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">code</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;366000600037611000600036600073&quot;</span>
        <span class="ow">and</span> <span class="n">code</span><span class="p">[</span><span class="mi">70</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;5af4602c57600080fd5b6110006000f3&quot;</span>
    <span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">code</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">70</span><span class="p">])</span>
    <span class="c1"># 0xSplits Clones</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">code</span><span class="p">[:</span><span class="mi">120</span><span class="p">]</span>
        <span class="o">==</span> <span class="s2">&quot;36603057343d52307f830d2d700a97af574b186c80d40429385d24241565b08a7c559ba283a964d9b160203da23d3df35b3d3d3d3d363d3d37363d73&quot;</span>  <span class="c1"># noqa e501</span>
        <span class="ow">and</span> <span class="n">code</span><span class="p">[</span><span class="mi">160</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;5af43d3d93803e605b57fd5bf3&quot;</span>
    <span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">_resolve_address</span><span class="p">(</span><span class="n">code</span><span class="p">[</span><span class="mi">120</span><span class="p">:</span><span class="mi">160</span><span class="p">])</span>

    <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;contract&quot;</span><span class="p">,</span> <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">address</span><span class="p">}</span>
    <span class="n">explorer</span><span class="p">,</span> <span class="n">env_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
        <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_explorer_tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">url</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">env_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_key</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;apiKey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">explorer</span><span class="si">}</span><span class="s2"> API token set. You may experience issues with rate limiting. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Visit https://</span><span class="si">{</span><span class="n">explorer</span><span class="si">}</span><span class="s2">.io/register to obtain a token, and then store it &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;as the environment variable $</span><span class="si">{</span><span class="n">env_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">BrownieEnvironmentWarning</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Fetching source of </span><span class="si">{</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;bright blue&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">address</span><span class="si">}{</span><span class="n">color</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;bright blue&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span><span class="si">}{</span><span class="n">color</span><span class="si">}</span><span class="s2">...&quot;</span>
        <span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">REQUEST_HEADERS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> when querying </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve data from API: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>


<span class="c1"># console auto-completion logic</span>


<span class="k">def</span> <span class="nf">_call_autosuggest</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="c1"># since methods are not unique for each object, we use `__reduce__`</span>
    <span class="c1"># to locate the specific object so we can access the correct ABI</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_contract_method_autosuggest</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_transact_autosuggest</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_contract_method_autosuggest</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">abi</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="n">payable</span><span class="p">)</span>


<span class="c1"># assign the autosuggest functionality to various methods</span>
<span class="n">ContractConstructor</span><span class="o">.</span><span class="n">encode_input</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_autosuggest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_call_autosuggest</span>
<span class="n">_ContractMethod</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_autosuggest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_call_autosuggest</span>
<span class="n">_ContractMethod</span><span class="o">.</span><span class="n">encode_input</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_autosuggest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_call_autosuggest</span>

<span class="n">ContractConstructor</span><span class="o">.</span><span class="n">estimate_gas</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_autosuggest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_transact_autosuggest</span>
<span class="n">_ContractMethod</span><span class="o">.</span><span class="n">estimate_gas</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_autosuggest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_transact_autosuggest</span>
<span class="n">_ContractMethod</span><span class="o">.</span><span class="n">transact</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_autosuggest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_transact_autosuggest</span>


<span class="k">def</span> <span class="nf">_contract_method_autosuggest</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">is_transaction</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">is_payable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="n">types_list</span> <span class="o">=</span> <span class="n">get_type_strings</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;fixed168x10&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal&quot;</span><span class="p">})</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">],</span> <span class="n">types_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span><span class="p">:</span>
        <span class="n">tx_hint</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">is_payable</span><span class="p">:</span>
        <span class="n">tx_hint</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; {&#39;from&#39;: Account&quot;</span><span class="p">,</span> <span class="s2">&quot; &#39;value&#39;: Wei}&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tx_hint</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; {&#39;from&#39;: Account}&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span> <span class="o">+</span> <span class="n">tx_hint</span>


<span class="k">def</span> <span class="nf">_comment_slicer</span><span class="p">(</span><span class="n">match</span><span class="p">:</span> <span class="n">Match</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># single line comment</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># multi line comment at start or end of a line</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">mid</span><span class="p">:</span>
        <span class="c1"># multi line comment with line break</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># multi line comment without line break</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, BobTheBuidler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>