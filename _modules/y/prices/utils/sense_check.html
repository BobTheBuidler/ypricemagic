<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>y.prices.utils.sense_check &mdash; ypricemagic  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ypricemagic
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules.html">y</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ypricemagic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">y.prices.utils.sense_check</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for y.prices.utils.sense_check</h1><div class="highlight"><pre>
<span></span><span class="c1"># async: done</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">a_sync</span>
<span class="kn">from</span> <span class="nn">brownie</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="kn">from</span> <span class="nn">y.classes.common</span> <span class="kn">import</span> <span class="n">ERC20</span>
<span class="kn">from</span> <span class="nn">y.constants</span> <span class="kn">import</span> <span class="n">wbtc</span><span class="p">,</span> <span class="n">weth</span>
<span class="kn">from</span> <span class="nn">y.contracts</span> <span class="kn">import</span> <span class="n">Contract</span>
<span class="kn">from</span> <span class="nn">y.exceptions</span> <span class="kn">import</span> <span class="n">NonStandardERC20</span>
<span class="kn">from</span> <span class="nn">y.networks</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">y.prices.lending.aave</span> <span class="kn">import</span> <span class="n">aave</span>
<span class="kn">from</span> <span class="nn">y.prices.lending.compound</span> <span class="kn">import</span> <span class="n">CToken</span>
<span class="kn">from</span> <span class="nn">y.prices.stable_swap.curve</span> <span class="kn">import</span> <span class="n">CurvePool</span>
<span class="kn">from</span> <span class="nn">y.prices.utils</span> <span class="kn">import</span> <span class="n">check_bucket</span>
<span class="kn">from</span> <span class="nn">y.prices.yearn</span> <span class="kn">import</span> <span class="n">YearnInspiredVault</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># This module is far from perfect, but provides an acceptable way to validate some of the prices returned by `get_price`</span>

<span class="n">acceptable_all_chains</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">weth</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
    <span class="n">wbtc</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ACCEPTABLE_HIGH_PRICES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Mainnet</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># eth and eth-like</span>
        <span class="s2">&quot;0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE&quot;</span><span class="p">,</span> <span class="c1"># eth</span>
        <span class="s2">&quot;0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0&quot;</span><span class="p">,</span> <span class="c1"># wsteth</span>
        <span class="s2">&quot;0xA3D87FffcE63B53E0d54fAa1cc983B7eB0b74A9c&quot;</span><span class="p">,</span> <span class="c1"># ecrv</span>
        <span class="s2">&quot;0xaA17A236F2bAdc98DDc0Cf999AbB47D47Fc0A6Cf&quot;</span><span class="p">,</span> <span class="c1"># ankrcrv</span>
        <span class="s2">&quot;0x53a901d48795C58f485cBB38df08FA96a24669D5&quot;</span><span class="p">,</span> <span class="c1"># rcrv</span>
        <span class="s2">&quot;0xC4C319E2D4d66CcA4464C0c2B32c9Bd23ebe784e&quot;</span><span class="p">,</span> <span class="c1"># alETH+ETH-f</span>
        <span class="s2">&quot;0x06325440D014e39736583c165C2963BA99fAf14E&quot;</span><span class="p">,</span> <span class="c1"># stecrv</span>
        <span class="s2">&quot;0x5e74C9036fb86BD7eCdcb084a0673EFc32eA31cb&quot;</span><span class="p">,</span> <span class="c1"># sETH</span>
        <span class="s2">&quot;0xae78736Cd615f374D3085123A210448E74Fc6393&quot;</span><span class="p">,</span> <span class="c1"># rETH</span>
        <span class="s2">&quot;0xE95A203B1a91a908F9B9CE46459d101078c2c3cb&quot;</span><span class="p">,</span> <span class="c1"># aETHc</span>
        <span class="s2">&quot;0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84&quot;</span><span class="p">,</span> <span class="c1"># stETH</span>
        <span class="s2">&quot;0x9559Aaa82d9649C7A7b220E7c461d2E74c9a3593&quot;</span><span class="p">,</span> <span class="c1"># rETH</span>
        <span class="s2">&quot;0x836A808d4828586A69364065A1e064609F5078c7&quot;</span><span class="p">,</span> <span class="c1"># pETH</span>
        <span class="s2">&quot;0xc3D088842DcF02C13699F936BB83DFBBc6f721Ab&quot;</span><span class="p">,</span> <span class="c1"># vETH</span>
        <span class="s2">&quot;0xC1330aCBbcE97cb9695B7ee161c0F95B875a8b0F&quot;</span><span class="p">,</span> <span class="c1"># onETH</span>
        <span class="s2">&quot;0x5E8422345238F34275888049021821E8E08CAa1f&quot;</span><span class="p">,</span> <span class="c1"># fxsETH</span>
        <span class="s2">&quot;0x856c4Efb76C1D1AE02e20CEB03A2A6a08b0b8dC3&quot;</span><span class="p">,</span> <span class="c1"># OETH</span>
        <span class="s2">&quot;0xE72B141DF173b999AE7c1aDcbF60Cc9833Ce56a8&quot;</span><span class="p">,</span> <span class="c1"># ETH+</span>
        <span class="s2">&quot;0x3d1E5Cf16077F349e999d6b21A4f646e83Cd90c5&quot;</span><span class="p">,</span> <span class="c1"># dETH</span>
        <span class="s2">&quot;0x0100546F2cD4C9D97f798fFC9755E47865FF7Ee6&quot;</span><span class="p">,</span> <span class="c1"># alETH</span>
        <span class="s2">&quot;0xBe9895146f7AF43049ca1c1AE358B0541Ea49704&quot;</span><span class="p">,</span> <span class="c1"># cbETH</span>
        <span class="s2">&quot;0x7C07F7aBe10CE8e33DC6C5aD68FE033085256A84&quot;</span><span class="p">,</span> <span class="c1"># icETH</span>
        <span class="s2">&quot;0xA35b1B31Ce002FBF2058D22F30f95D405200A15b&quot;</span><span class="p">,</span> <span class="c1"># ETHx</span>
        <span class="s2">&quot;0x64351fC9810aDAd17A690E4e1717Df5e7e085160&quot;</span><span class="p">,</span> <span class="c1"># msETH</span>
        <span class="s2">&quot;0x821A278dFff762c76410264303F25bF42e195C0C&quot;</span><span class="p">,</span> <span class="c1"># pETH</span>
        <span class="s2">&quot;0xa2E3356610840701BDf5611a53974510Ae27E2e1&quot;</span><span class="p">,</span> <span class="c1"># wbETH</span>
        <span class="s2">&quot;0x1BED97CBC3c24A4fb5C069C6E311a967386131f7&quot;</span><span class="p">,</span> <span class="c1"># yETH</span>
        <span class="c1"># btc and btc-like</span>
        <span class="s2">&quot;0xEB4C2781e4ebA804CE9a9803C67d0893436bB27D&quot;</span><span class="p">,</span> <span class="c1"># renbtc</span>
        <span class="s2">&quot;0xfE18be6b3Bd88A2D2A7f928d00292E7a9963CfC6&quot;</span><span class="p">,</span> <span class="c1"># sbtc</span>
        <span class="s2">&quot;0x49849C98ae39Fff122806C06791Fa73784FB3675&quot;</span><span class="p">,</span> <span class="c1"># crvrenwbtc</span>
        <span class="s2">&quot;0x075b1bb99792c9E1041bA13afEf80C91a1e70fB3&quot;</span><span class="p">,</span> <span class="c1"># crvrenwsbtc</span>
        <span class="s2">&quot;0xb19059ebb43466C323583928285a49f558E572Fd&quot;</span><span class="p">,</span> <span class="c1"># hcrv</span>
        <span class="s2">&quot;0x64eda51d3Ad40D56b9dFc5554E06F94e1Dd786Fd&quot;</span><span class="p">,</span> <span class="c1"># tbtc/sbtcCrv</span>
        <span class="s2">&quot;0xDE5331AC4B3630f94853Ff322B66407e0D6331E8&quot;</span><span class="p">,</span> <span class="c1"># pBTC/sbtcCRV</span>
        <span class="s2">&quot;0x410e3E86ef427e30B9235497143881f717d93c2A&quot;</span><span class="p">,</span> <span class="c1"># bBTC/sbtcCRV</span>
        <span class="s2">&quot;0x2fE94ea3d5d4a175184081439753DE15AeF9d614&quot;</span><span class="p">,</span> <span class="c1"># oBTC/sbtcCRV</span>
        <span class="s2">&quot;0x0327112423F3A68efdF1fcF402F6c5CB9f7C33fd&quot;</span><span class="p">,</span> <span class="c1"># btc++</span>
        <span class="s2">&quot;0x3212b29E33587A00FB1C83346f5dBFA69A458923&quot;</span><span class="p">,</span> <span class="c1"># imbtc</span>
        <span class="s2">&quot;0x5228a22e72ccC52d415EcFd199F99D0665E7733b&quot;</span><span class="p">,</span> <span class="c1"># pbtc</span>
        <span class="s2">&quot;0xFbdCA68601f835b27790D98bbb8eC7f05FDEaA9B&quot;</span><span class="p">,</span> <span class="c1"># ibbtc/sbtcCRV-f</span>
        <span class="s2">&quot;0x0316EB71485b0Ab14103307bf65a021042c6d380&quot;</span><span class="p">,</span> <span class="c1"># hbtc</span>
        <span class="s2">&quot;0x9BE89D2a4cd102D8Fecc6BF9dA793be995C22541&quot;</span><span class="p">,</span> <span class="c1"># bbtc</span>
        <span class="s2">&quot;0x8064d9Ae6cDf087b1bcd5BDf3531bD5d8C537a68&quot;</span><span class="p">,</span> <span class="c1"># obtc</span>
        <span class="s2">&quot;0x8dAEBADE922dF735c38C80C7eBD708Af50815fAa&quot;</span><span class="p">,</span> <span class="c1"># tbtc</span>
        <span class="s2">&quot;0x8751D4196027d4e6DA63716fA7786B5174F04C15&quot;</span><span class="p">,</span> <span class="c1"># wibbtc</span>
        <span class="s2">&quot;0x66eFF5221ca926636224650Fd3B9c497FF828F7D&quot;</span><span class="p">,</span> <span class="c1"># multiBTC</span>
        <span class="s2">&quot;0x18084fbA666a33d37592fA2633fD49a74DD93a88&quot;</span><span class="p">,</span> <span class="c1"># tbtc</span>
        <span class="c1"># gold tokens</span>
        <span class="s2">&quot;0x45804880De22913dAFE09f4980848ECE6EcbAf78&quot;</span><span class="p">,</span> <span class="c1"># paxg</span>
        <span class="s2">&quot;0x4922a015c4407F87432B179bb209e125432E4a2A&quot;</span><span class="p">,</span> <span class="c1"># xaut</span>
        <span class="c1"># other</span>
        <span class="s2">&quot;0x0bc529c00C6401aEF6D220BE8C6Ea1667F6Ad93e&quot;</span><span class="p">,</span> <span class="c1"># yfi</span>
        <span class="s2">&quot;0x1cEB5cB57C4D4E2b2433641b95Dd330A33185A44&quot;</span><span class="p">,</span> <span class="c1"># kp3r</span>
        <span class="s2">&quot;0xD5525D397898e5502075Ea5E830d8914f6F0affe&quot;</span><span class="p">,</span> <span class="c1"># meme</span>
        <span class="s2">&quot;0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2&quot;</span><span class="p">,</span> <span class="c1"># mkr</span>
        <span class="s2">&quot;0x3A283D9c08E8b55966afb64C515f5143cf907611&quot;</span><span class="p">,</span> <span class="c1"># crvCVXETH</span>
        <span class="s2">&quot;0x23B608675a2B2fB1890d3ABBd85c5775c51691d5&quot;</span><span class="p">,</span> <span class="c1"># socks</span>
        <span class="s2">&quot;0xcA3d75aC011BF5aD07a98d02f18225F9bD9A6BDF&quot;</span><span class="p">,</span> <span class="c1"># crvtricrypto</span>
        <span class="s2">&quot;0xc4AD29ba4B3c580e6D59105FFf484999997675Ff&quot;</span><span class="p">,</span> <span class="c1"># crv3crypto</span>
        <span class="s2">&quot;0xd075e95423C5c4BA1E122CaE0f4CdFA19b82881b&quot;</span><span class="p">,</span> <span class="c1"># wPE</span>
        <span class="s2">&quot;0xe9F84dE264E91529aF07Fa2C746e934397810334&quot;</span><span class="p">,</span> <span class="c1"># sak3</span>
        <span class="s2">&quot;0xa1d0E215a23d7030842FC67cE582a6aFa3CCaB83&quot;</span><span class="p">,</span> <span class="c1"># yfii</span>
        <span class="s2">&quot;0x0fe629d1E84E171f8fF0C1Ded2Cc2221Caa48a3f&quot;</span><span class="p">,</span> <span class="c1"># mask</span>
        <span class="s2">&quot;0x5F0E628B693018f639D10e4A4F59BD4d8B2B6B44&quot;</span><span class="p">,</span> <span class="c1"># white</span>
        <span class="s2">&quot;0xdBdb4d16EdA451D0503b854CF79D55697F90c8DF&quot;</span><span class="p">,</span> <span class="c1"># alcx</span>
        <span class="s2">&quot;0x3aaDA3e213aBf8529606924d8D1c55CbDc70Bf74&quot;</span><span class="p">,</span> <span class="c1"># xMON</span>
        <span class="s2">&quot;0x892A6f9dF0147e5f079b0993F486F9acA3c87881&quot;</span><span class="p">,</span> <span class="c1"># xFUND</span>
        <span class="s2">&quot;0x0ab87046fBb341D058F17CBC4c1133F25a20a52f&quot;</span><span class="p">,</span> <span class="c1"># gOHM</span>
        <span class="s2">&quot;0x97983236bE88107Cc8998733Ef73D8d969c52E37&quot;</span><span class="p">,</span> <span class="c1"># sdYFI</span>
        <span class="s2">&quot;0x68749665FF8D2d112Fa859AA293F07A622782F38&quot;</span><span class="p">,</span> <span class="c1"># XAUt</span>
        <span class="s2">&quot;0xf5f5B97624542D72A9E06f04804Bf81baA15e2B4&quot;</span><span class="p">,</span> <span class="c1"># crvUSDTWBTCWETH</span>
        <span class="s2">&quot;0x7F86Bf177Dd4F3494b841a37e810A34dD56c829B&quot;</span><span class="p">,</span> <span class="c1"># crvUSDCWBTCWETH</span>
        <span class="s2">&quot;0x2889302a794dA87fBF1D6Db415C1492194663D13&quot;</span><span class="p">,</span> <span class="c1"># crvCRVUSDTBTCWSTETH</span>
        <span class="s2">&quot;0xBfAb6FA95E0091ed66058ad493189D2cB29385E6&quot;</span><span class="p">,</span> <span class="c1"># ETHwBETHCRV</span>
        <span class="c1"># nfts</span>
        <span class="s2">&quot;0x641927E970222B10b2E8CDBC96b1B4F427316f16&quot;</span><span class="p">,</span> <span class="c1"># meeb</span>
        <span class="s2">&quot;0x9cea2eD9e47059260C97d697f82b8A14EfA61EA5&quot;</span><span class="p">,</span> <span class="c1"># punk</span>
        <span class="s2">&quot;0x269616D549D7e8Eaa82DFb17028d0B212D11232A&quot;</span><span class="p">,</span> <span class="c1"># punk (different)</span>
        <span class="s2">&quot;0x69BbE2FA02b4D90A944fF328663667DC32786385&quot;</span><span class="p">,</span> <span class="c1"># punk-basic</span>
        <span class="s2">&quot;0xD70240Dd62F4ea9a6A2416e0073D72139489d2AA&quot;</span><span class="p">,</span> <span class="c1"># glyph</span>
        <span class="s2">&quot;0x114f1388fAB456c4bA31B1850b244Eedcd024136&quot;</span><span class="p">,</span> <span class="c1"># coolcats</span>
        <span class="s2">&quot;0xEA47B64e1BFCCb773A0420247C0aa0a3C1D2E5C5&quot;</span><span class="p">,</span> <span class="c1"># bayc</span>
    <span class="p">],</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">BinanceSmartChain</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># eth and eth-like</span>
        <span class="s2">&quot;0x8d0e18c97e5dd8ee2b539ae8cd3a3654df5d79e5&quot;</span><span class="p">,</span> <span class="c1"># bweth</span>
        <span class="s2">&quot;0xbfF4a34A4644a113E8200D7F1D79b3555f723AfE&quot;</span><span class="p">,</span> <span class="c1"># ibeth</span>
        <span class="c1"># btc and btc-like</span>
        <span class="s2">&quot;0x7130d2A12B9BCbFAe4f2634d864A1Ee1Ce3Ead9c&quot;</span><span class="p">,</span> <span class="c1"># btcb</span>
        <span class="s2">&quot;0x08FC9Ba2cAc74742177e0afC3dC8Aed6961c24e7&quot;</span><span class="p">,</span> <span class="c1"># ibbtcb</span>
    <span class="p">],</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Fantom</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># eth and eth-like</span>
        <span class="s2">&quot;0xBDC8fd437C489Ca3c6DA3B5a336D11532a532303&quot;</span><span class="p">,</span> <span class="c1"># anyeth</span>
        <span class="c1"># btc and btc-like</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">,</span> <span class="c1"># renbtc</span>
        <span class="s2">&quot;0x2406dCe4dA5aB125A18295f4fB9FD36a0f7879A2&quot;</span><span class="p">,</span> <span class="c1"># anybtc</span>
        <span class="c1"># other</span>
        <span class="s2">&quot;0x29b0Da86e484E1C0029B56e817912d778aC0EC69&quot;</span><span class="p">,</span> <span class="c1"># yfi</span>
        <span class="s2">&quot;0xf43Cc235E686d7BC513F53Fbffb61F760c3a1882&quot;</span><span class="p">,</span> <span class="c1"># elite</span>
        <span class="s2">&quot;0x58e57cA18B7A47112b877E31929798Cd3D703b0f&quot;</span><span class="p">,</span> <span class="c1"># crv3crypto</span>
    <span class="p">],</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Avalanche</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># btc and btc-like</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">,</span> <span class="c1"># renbtc</span>
        <span class="c1"># other</span>
        <span class="s2">&quot;0xd6070ae98b8069de6B494332d1A1a81B6179D960&quot;</span><span class="p">,</span> <span class="c1"># bifi</span>
    <span class="p">],</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Optimism</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># eth and eth-like</span>
        <span class="s2">&quot;0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE&quot;</span><span class="p">,</span> <span class="c1"># eth</span>
        <span class="s2">&quot;0x9Bcef72be871e61ED4fBbc7630889beE758eb81D&quot;</span><span class="p">,</span> <span class="c1"># reth</span>
        <span class="s2">&quot;0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb&quot;</span><span class="p">,</span> <span class="c1"># wsteth</span>
        <span class="s2">&quot;0x6806411765Af15Bddd26f8f544A34cC40cb9838B&quot;</span><span class="p">,</span> <span class="c1"># frxeth</span>
        <span class="s2">&quot;0x484c2D6e3cDd945a8B2DF735e079178C1036578c&quot;</span><span class="p">,</span> <span class="c1"># sfrxeth</span>
        <span class="s2">&quot;0x1610e3c85dd44Af31eD7f33a63642012Dca0C5A5&quot;</span><span class="p">,</span> <span class="c1"># mseth</span>
        <span class="s2">&quot;0x3E29D3A9316dAB217754d13b28646B76607c5f04&quot;</span><span class="p">,</span> <span class="c1"># aleth</span>
        <span class="s2">&quot;0xE405de8F52ba7559f9df3C368500B6E6ae6Cee49&quot;</span><span class="p">,</span> <span class="c1"># seth</span>
        <span class="c1"># btc and btc-like</span>
        <span class="s2">&quot;0x298B9B95708152ff6968aafd889c6586e9169f1D&quot;</span><span class="p">,</span> <span class="c1"># sbtc</span>
        <span class="s2">&quot;0x6c84a8f1c29108F47a79964b5Fe888D4f4D0dE40&quot;</span><span class="p">,</span> <span class="c1"># tbtc</span>
    <span class="p">],</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Arbitrum</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;0x8e0B8c8BB9db49a46697F3a5Bb8A308e744821D2&quot;</span><span class="p">,</span> <span class="c1"># crv3crypto</span>
    <span class="p">],</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Base</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># eth and eth-like</span>
        <span class="s2">&quot;0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22&quot;</span><span class="p">,</span> <span class="c1"># cbeth</span>
        <span class="s2">&quot;0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452&quot;</span><span class="p">,</span> <span class="c1"># wsteth</span>
        <span class="c1"># btc and btc-like</span>
        <span class="s2">&quot;0x236aa50979D5f3De3Bd1Eeb40E81137F22ab794b&quot;</span><span class="p">,</span> <span class="c1"># tbtc</span>
    <span class="p">],</span>
<span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">acceptable_all_chains</span>

<div class="viewcode-block" id="sense_check">
<a class="viewcode-back" href="../../../../source/y.prices.utils.html#y.prices.utils.sense_check.sense_check">[docs]</a>
<span class="k">async</span> <span class="k">def</span> <span class="nf">sense_check</span><span class="p">(</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">block</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">price</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>

    <span class="c1"># if price is in &quot;normal&quot; range, exit sense check</span>
    <span class="k">if</span> <span class="n">price</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="c1"># if we&#39;ve already validated that the token should have a high price, exit sense check</span>
    <span class="k">if</span> <span class="n">token_address</span> <span class="ow">in</span> <span class="n">ACCEPTABLE_HIGH_PRICES</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># for some token types, its normal to have a crazy high nominal price</span>
    <span class="c1"># we can skip the sense check for those</span>
    <span class="k">if</span> <span class="k">await</span> <span class="n">_exit_sense_check</span><span class="p">(</span><span class="n">token_address</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># proceed with sense check</span>
    <span class="n">price_readable</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ERC20</span><span class="p">(</span><span class="n">token_address</span><span class="p">,</span> <span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">symbol</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unusually high price ($</span><span class="si">{</span><span class="n">price_readable</span><span class="si">}</span><span class="s1">) returned for </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">token_address</span><span class="si">}</span><span class="s1"> on </span><span class="si">{</span><span class="n">network</span><span class="si">}</span><span class="s1"> block </span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">. This does not necessarily mean that the price is wrong, but you may want to validate the price for yourself before proceeding.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">NonStandardERC20</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unusually high price ($</span><span class="si">{</span><span class="n">price_readable</span><span class="si">}</span><span class="s1">) returned for </span><span class="si">{</span><span class="n">token_address</span><span class="si">}</span><span class="s1"> on </span><span class="si">{</span><span class="n">network</span><span class="si">}</span><span class="s1"> block </span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">. This does not necessarily mean that the price is wrong, but you may want to validate the price for yourself before proceeding.&#39;</span><span class="p">)</span></div>



<span class="c1">#yLazyLogger(logger)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">_exit_sense_check</span><span class="p">(</span><span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    For some token types, its normal to have a crazy high nominal price.</span>
<span class="sd">    We can skip the sense check for those.</span>
<span class="sd">    We can also skip wrapped versions of tokens in `ACCEPTABLE_HIGH_PRICES`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">bucket</span> <span class="o">=</span> <span class="k">await</span> <span class="n">check_bucket</span><span class="p">(</span><span class="n">token_address</span><span class="p">,</span> <span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;uni or uni-like lp&#39;</span><span class="p">,</span> <span class="s1">&#39;balancer pool&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">bucket</span> <span class="o">==</span> <span class="s1">&#39;curve lp&#39;</span><span class="p">:</span>
        <span class="n">underlyings</span> <span class="o">=</span> <span class="k">await</span> <span class="n">CurvePool</span><span class="p">(</span><span class="n">token_address</span><span class="p">,</span> <span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">coins</span>
        <span class="k">if</span> <span class="n">questionable_underlyings</span> <span class="o">:=</span> <span class="p">[</span><span class="n">und</span> <span class="k">for</span> <span class="n">und</span> <span class="ow">in</span> <span class="n">underlyings</span> <span class="k">if</span> <span class="n">und</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ACCEPTABLE_HIGH_PRICES</span><span class="p">]:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">a_sync</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_exit_sense_check</span><span class="p">,</span> <span class="n">questionable_underlyings</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">elif</span> <span class="n">bucket</span> <span class="o">==</span> <span class="s1">&#39;atoken&#39;</span><span class="p">:</span>
        <span class="n">underlying</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aave</span><span class="o">.</span><span class="n">underlying</span><span class="p">(</span><span class="n">token_address</span><span class="p">,</span> <span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">bucket</span> <span class="o">==</span> <span class="s1">&#39;compound&#39;</span><span class="p">:</span>
        <span class="n">underlying</span> <span class="o">=</span> <span class="k">await</span> <span class="n">CToken</span><span class="p">(</span><span class="n">token_address</span><span class="p">,</span> <span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">underlying</span>
    <span class="k">elif</span> <span class="n">bucket</span> <span class="o">==</span> <span class="s1">&#39;solidex&#39;</span><span class="p">:</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Contract</span><span class="o">.</span><span class="n">coroutine</span><span class="p">(</span><span class="n">token_address</span><span class="p">)</span>
        <span class="n">underlying</span> <span class="o">=</span> <span class="k">await</span> <span class="n">contract</span><span class="o">.</span><span class="n">pool</span>
    <span class="k">elif</span> <span class="n">bucket</span> <span class="o">==</span> <span class="s1">&#39;yearn or yearn-like&#39;</span><span class="p">:</span>
        <span class="n">underlying</span> <span class="o">=</span> <span class="k">await</span> <span class="n">YearnInspiredVault</span><span class="p">(</span><span class="n">token_address</span><span class="p">,</span> <span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">underlying</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">underlying</span> <span class="ow">in</span> <span class="n">ACCEPTABLE_HIGH_PRICES</span> <span class="ow">or</span> <span class="k">await</span> <span class="n">_exit_sense_check</span><span class="p">(</span><span class="n">underlying</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, BobTheBuidler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>