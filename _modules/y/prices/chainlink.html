

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>y.prices.chainlink &mdash; ypricemagic  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ypricemagic
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/modules.html">y</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../caching.html">Caching in ypricemagic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">CLI Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ypricemagic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">y.prices.chainlink</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for y.prices.chainlink</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncIterator</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">a_sync</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dank_mids</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">async_lru</span><span class="w"> </span><span class="kn">import</span> <span class="n">alru_cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">brownie</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZERO_ADDRESS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">brownie.network.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">_EventItem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multicall</span><span class="w"> </span><span class="kn">import</span> <span class="n">Call</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">web3.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContractLogicError</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">y</span><span class="w"> </span><span class="kn">import</span> <span class="n">ENVIRONMENT_VARIABLES</span> <span class="k">as</span> <span class="n">ENVS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y._decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">stuck_coro_debugger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.classes.common</span><span class="w"> </span><span class="kn">import</span> <span class="n">ERC20</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">CHAINID</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.contracts</span><span class="w"> </span><span class="kn">import</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">contract_creation_block_async</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.datatypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">AnyAddressType</span><span class="p">,</span> <span class="n">Block</span><span class="p">,</span> <span class="n">UsdPrice</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnsupportedNetwork</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.networks</span><span class="w"> </span><span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.utils.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">a_sync_ttl_cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">y.utils.events</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessedEvents</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">DENOMINATIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ETH&quot;</span><span class="p">:</span> <span class="s2">&quot;0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BTC&quot;</span><span class="p">:</span> <span class="s2">&quot;0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USD&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0000000000000000000000000000000000000348&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">registries</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># https://docs.chain.link/docs/feed-registry/#contract-addresses</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Mainnet</span><span class="p">:</span> <span class="s2">&quot;0x47Fb2585D2C56Fe188D0E6ec628a38b74fCeeeDf&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># These are feeds we specify anually in addition to the ones fetched from the registry.</span>
<span class="c1"># After selecting for `CHAINID`, `FEEDS` will return a dict {token_in: feed_address}</span>
<span class="n">FEEDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Mainnet</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF4030086522a5bEEa4988F8cA5B36dbC97BeE88c&quot;</span><span class="p">,</span>  <span class="c1"># wbtc -&gt; BTC</span>
        <span class="s2">&quot;0xfE18be6b3Bd88A2D2A7f928d00292E7a9963CfC6&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF4030086522a5bEEa4988F8cA5B36dbC97BeE88c&quot;</span><span class="p">,</span>  <span class="c1"># sbtc -&gt; BTC</span>
        <span class="s2">&quot;0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2&quot;</span><span class="p">:</span> <span class="s2">&quot;0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419&quot;</span><span class="p">,</span>  <span class="c1"># weth -&gt; ETH</span>
        <span class="s2">&quot;0x0100546F2cD4C9D97f798fFC9755E47865FF7Ee6&quot;</span><span class="p">:</span> <span class="s2">&quot;0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419&quot;</span><span class="p">,</span>  <span class="c1"># aleth -&gt; ETH</span>
        <span class="s2">&quot;0xdB25f211AB05b1c97D595516F45794528a807ad8&quot;</span><span class="p">:</span> <span class="s2">&quot;0xb49f677943BC038e9857d61E7d053CaA2C1734C1&quot;</span><span class="p">,</span>  <span class="c1"># eurs -&gt; EUR</span>
        <span class="s2">&quot;0x9fcf418B971134625CdF38448B949C8640971671&quot;</span><span class="p">:</span> <span class="s2">&quot;0xb49f677943BC038e9857d61E7d053CaA2C1734C1&quot;</span><span class="p">,</span>  <span class="c1"># eurn-&gt; EUR</span>
        <span class="s2">&quot;0xC581b735A1688071A1746c968e0798D642EDE491&quot;</span><span class="p">:</span> <span class="s2">&quot;0xb49f677943BC038e9857d61E7d053CaA2C1734C1&quot;</span><span class="p">,</span>  <span class="c1"># eurt -&gt; EUR</span>
        <span class="s2">&quot;0xD71eCFF9342A5Ced620049e616c5035F1dB98620&quot;</span><span class="p">:</span> <span class="s2">&quot;0xb49f677943BC038e9857d61E7d053CaA2C1734C1&quot;</span><span class="p">,</span>  <span class="c1"># seur -&gt; EUR</span>
        <span class="s2">&quot;0x1a7e4e63778B4f12a199C062f3eFdD288afCBce8&quot;</span><span class="p">:</span> <span class="s2">&quot;0xb49f677943BC038e9857d61E7d053CaA2C1734C1&quot;</span><span class="p">,</span>  <span class="c1"># ageur -&gt; EUR</span>
        <span class="s2">&quot;0x81d66D255D47662b6B16f3C5bbfBb15283B05BC2&quot;</span><span class="p">:</span> <span class="s2">&quot;0x438F81D95761d7036cd2617295827D9d01Cf593f&quot;</span><span class="p">,</span>  <span class="c1"># ibzar -&gt; ZAR</span>
        <span class="s2">&quot;0xf6b1c627e95bfc3c1b4c9b825a032ff0fbf3e07d&quot;</span><span class="p">:</span> <span class="s2">&quot;0xBcE206caE7f0ec07b545EddE332A47C2F75bbeb3&quot;</span><span class="p">,</span>  <span class="c1"># sJPY -&gt; JPY</span>
        <span class="s2">&quot;0x5555f75e3d5278082200Fb451D1b6bA946D8e13b&quot;</span><span class="p">:</span> <span class="s2">&quot;0xBcE206caE7f0ec07b545EddE332A47C2F75bbeb3&quot;</span><span class="p">,</span>  <span class="c1"># ibjpy -&gt; JPY</span>
        <span class="s2">&quot;0xFAFdF0C4c1CB09d430Bf88c75D88BB46DAe09967&quot;</span><span class="p">:</span> <span class="s2">&quot;0x77F9710E7d0A19669A13c055F62cd80d313dF022&quot;</span><span class="p">,</span>  <span class="c1"># ibAUD -&gt; AUD</span>
        <span class="s2">&quot;0x95dFDC8161832e4fF7816aC4B6367CE201538253&quot;</span><span class="p">:</span> <span class="s2">&quot;0x01435677fb11763550905594a16b645847c1d0f3&quot;</span><span class="p">,</span>  <span class="c1"># ibKRW -&gt; KRW</span>
        <span class="s2">&quot;0x69681f8fde45345C3870BCD5eaf4A05a60E7D227&quot;</span><span class="p">:</span> <span class="s2">&quot;0x5c0Ab2d9b5a7ed9f470386e82BB36A3613cDd4b5&quot;</span><span class="p">,</span>  <span class="c1"># ibGBP -&gt; GBP</span>
        <span class="s2">&quot;0x1CC481cE2BD2EC7Bf67d1Be64d4878b16078F309&quot;</span><span class="p">:</span> <span class="s2">&quot;0x449d117117838fFA61263B61dA6301AA2a88B13A&quot;</span><span class="p">,</span>  <span class="c1"># ibCHF -&gt; CHF</span>
        <span class="s2">&quot;0x9AFb950948c2370975fb91a441F36FDC02737cD4&quot;</span><span class="p">:</span> <span class="s2">&quot;0x1A31D42149e82Eb99777f903C08A2E41A00085d3&quot;</span><span class="p">,</span>  <span class="c1"># hFIL -&gt; FIL</span>
        <span class="s2">&quot;0x5CAF29fD8efbe4ED0cfc43A8a211B276E9889583&quot;</span><span class="p">:</span> <span class="s2">&quot;0x1A31D42149e82Eb99777f903C08A2E41A00085d3&quot;</span><span class="p">,</span>  <span class="c1"># renFIL -&gt; FIL</span>
        <span class="s2">&quot;0xEB4C2781e4ebA804CE9a9803C67d0893436bB27D&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF4030086522a5bEEa4988F8cA5B36dbC97BeE88c&quot;</span><span class="p">,</span>  <span class="c1"># renbtc -&gt; BTC</span>
        <span class="s2">&quot;0x1C5db575E2Ff833E46a2E9864C22F4B22E0B37C2&quot;</span><span class="p">:</span> <span class="s2">&quot;0xd54B033D48d0475f19c5fccf7484E8A981848501&quot;</span><span class="p">,</span>  <span class="c1"># renzec -&gt; ZEC</span>
        <span class="s2">&quot;0x459086F2376525BdCebA5bDDA135e4E9d3FeF5bf&quot;</span><span class="p">:</span> <span class="s2">&quot;0x9F0F69428F923D6c95B781F89E165C9b2df9789D&quot;</span><span class="p">,</span>  <span class="c1"># renbch -&gt; BCH</span>
        <span class="s2">&quot;0x3832d2F059E55934220881F831bE501D180671A7&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2465CefD3b488BE410b941b1d4b2767088e2A028&quot;</span><span class="p">,</span>  <span class="c1"># rendoge -&gt; DOGE</span>
        <span class="s2">&quot;0x945Facb997494CC2570096c74b5F66A3507330a1&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF4030086522a5bEEa4988F8cA5B36dbC97BeE88c&quot;</span><span class="p">,</span>  <span class="c1"># mbtc -&gt; BTC</span>
        <span class="s2">&quot;0x68749665FF8D2d112Fa859AA293F07A622782F38&quot;</span><span class="p">:</span> <span class="s2">&quot;0x214eD9Da11D2fbe465a6fc601a91E62EbEc1a0D6&quot;</span><span class="p">,</span>  <span class="c1"># xaut -&gt; xau</span>
        <span class="s2">&quot;0xa693B19d2931d498c5B318dF961919BB4aee87a5&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8b6d9085f310396C6E4f0012783E9f850eaa8a82&quot;</span><span class="p">,</span>  <span class="c1"># ust -&gt; UST</span>
        <span class="s2">&quot;0xD46bA6D942050d489DBd938a2C909A5d5039A161&quot;</span><span class="p">:</span> <span class="s2">&quot;0xe20CA8D7546932360e37E9D72c1a47334af57706&quot;</span><span class="p">,</span>  <span class="c1"># ampl -&gt; AMPL</span>
        <span class="s2">&quot;0x13B02c8dE71680e71F0820c996E4bE43c2F57d15&quot;</span><span class="p">:</span> <span class="s2">&quot;0x6b54e83f44047d2168a195ABA5e9b768762167b5&quot;</span><span class="p">,</span>  <span class="c1"># mqqq -&gt; qqq</span>
        <span class="s2">&quot;0xd36932143F6eBDEDD872D5Fb0651f4B72Fd15a84&quot;</span><span class="p">:</span> <span class="s2">&quot;0x139C8512Cde1778e9b9a8e721ce1aEbd4dD43587&quot;</span><span class="p">,</span>  <span class="c1"># maapl -&gt; aapl</span>
        <span class="s2">&quot;0x4e840AADD28DA189B9906674B4Afcb77C128d9ea&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8c110B94C5f1d347fAcF5E1E938AB2db60E3c9a8&quot;</span><span class="p">,</span>  <span class="c1"># anyspell -&gt; spell</span>
        <span class="s2">&quot;0xdeFA4e8a7bcBA345F687a2f1456F5Edd9CE97202&quot;</span><span class="p">:</span> <span class="s2">&quot;0xf8fF43E991A81e6eC886a3D281A2C6cC19aE70Fc&quot;</span><span class="p">,</span>  <span class="c1"># knc -&gt; knc</span>
        <span class="s2">&quot;0xEa5A82B35244d9e5E48781F00b11B14E627D2951&quot;</span><span class="p">:</span> <span class="s2">&quot;0xDC4BDB458C6361093069Ca2aD30D74cc152EdC75&quot;</span><span class="p">,</span>  <span class="c1"># atom -&gt; atom</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">BinanceSmartChain</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0xfCe146bF3146100cfe5dB4129cf6C82b0eF4Ad8c&quot;</span><span class="p">:</span> <span class="s2">&quot;0x264990fbd0A4796A3E3d8E37C4d5F87a3aCa5Ebf&quot;</span><span class="p">,</span>  <span class="c1"># renbtc -&gt; BTC</span>
        <span class="s2">&quot;0xA164B067193bd119933e5C1e7877421FCE53D3E5&quot;</span><span class="p">:</span> <span class="s2">&quot;0x43d80f616DAf0b0B42a928EeD32147dC59027D41&quot;</span><span class="p">,</span>  <span class="c1"># renbch -&gt; BCH</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">:</span> <span class="s2">&quot;0xE5dbFD9003bFf9dF5feB2f4F445Ca00fb121fb83&quot;</span><span class="p">,</span>  <span class="c1"># renfil -&gt; FIL</span>
        <span class="s2">&quot;0xc3fEd6eB39178A541D274e6Fc748d48f0Ca01CC3&quot;</span><span class="p">:</span> <span class="s2">&quot;0x3AB0A0d137D4F946fBB19eecc6e92E64660231C8&quot;</span><span class="p">,</span>  <span class="c1"># rendoge -&gt; DOGE</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0x4c28f48448720e9000907BC2611F73022fdcE1fA&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF9680D99D6C9589e2a93a78A04A279e509205945&quot;</span><span class="p">,</span>  <span class="c1"># weth -&gt; ETH</span>
        <span class="s2">&quot;0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6&quot;</span><span class="p">:</span> <span class="s2">&quot;0xc907E116054Ad103354f2D350FD2514433D57F6f&quot;</span><span class="p">,</span>  <span class="c1"># wbtc -&gt; BTC</span>
        <span class="s2">&quot;0xb33EaAd8d922B1083446DC23f610c2567fB5180f&quot;</span><span class="p">:</span> <span class="s2">&quot;0xdf0Fb4e4F928d2dCB76f438575fDD8682386e13C&quot;</span><span class="p">,</span>  <span class="c1"># uni -&gt; UNI</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">:</span> <span class="s2">&quot;0xc907E116054Ad103354f2D350FD2514433D57F6f&quot;</span><span class="p">,</span>  <span class="c1"># renbtc -&gt; BTC</span>
        <span class="s2">&quot;0x0694bf58a4F48C5970454CD4874218eBa843Cf3e&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF9680D99D6C9589e2a93a78A04A279e509205945&quot;</span><span class="p">,</span>  <span class="c1"># reneth -&gt; ETH</span>
        <span class="s2">&quot;0xc3fEd6eB39178A541D274e6Fc748d48f0Ca01CC3&quot;</span><span class="p">:</span> <span class="s2">&quot;0x327d9822e9932996f55b39F557AEC838313da8b7&quot;</span><span class="p">,</span>  <span class="c1"># renbch -&gt; BCH</span>
        <span class="s2">&quot;0x31a0D1A199631D244761EEba67e8501296d2E383&quot;</span><span class="p">:</span> <span class="s2">&quot;0xBC08c639e579a391C4228F20d0C29d0690092DF0&quot;</span><span class="p">,</span>  <span class="c1"># renzec -&gt; ZEC</span>
        <span class="s2">&quot;0xcE829A89d4A55a63418bcC43F00145adef0eDB8E&quot;</span><span class="p">:</span> <span class="s2">&quot;0xbaf9327b6564454F4a3364C33eFeEf032b4b4444&quot;</span><span class="p">,</span>  <span class="c1"># rendoge -&gt; DOGE</span>
        <span class="s2">&quot;0x7c7DAAF2dB46fEFd067f002a69FD0BE14AeB159f&quot;</span><span class="p">:</span> <span class="s2">&quot;0x1248573D9B62AC86a3ca02aBC6Abe6d403Cd1034&quot;</span><span class="p">,</span>  <span class="c1"># renluna -&gt; LUNA</span>
        <span class="s2">&quot;0x6E48a0c5386211837d99DacA233f45EF5aa5f594&quot;</span><span class="p">:</span> <span class="s2">&quot;0xfE4A8cc5b5B2366C1B58Bea3858e81843581b2F7&quot;</span><span class="p">,</span>  <span class="c1"># renusdc -&gt; USDC</span>
        <span class="s2">&quot;0xf55941e971302C634c586416c43469F3EaD5ad3e&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0A6513e40db6EB1b165753AD52E80663aeA50545&quot;</span><span class="p">,</span>  <span class="c1"># renusdt -&gt; USDT</span>
        <span class="s2">&quot;0x7BDF330f423Ea880FF95fC41A280fD5eCFD3D09f&quot;</span><span class="p">:</span> <span class="s2">&quot;0x73366Fe0AA0Ded304479862808e02506FE556a98&quot;</span><span class="p">,</span>  <span class="c1"># eurt -&gt; EUR</span>
        <span class="s2">&quot;0x4e3Decbb3645551B8A19f0eA1678079FCB33fB4c&quot;</span><span class="p">:</span> <span class="s2">&quot;0x73366Fe0AA0Ded304479862808e02506FE556a98&quot;</span><span class="p">,</span>  <span class="c1"># jeur -&gt; EUR</span>
        <span class="s2">&quot;0xE0B52e49357Fd4DAf2c15e02058DCE6BC0057db4&quot;</span><span class="p">:</span> <span class="s2">&quot;0x73366Fe0AA0Ded304479862808e02506FE556a98&quot;</span><span class="p">,</span>  <span class="c1"># ageur -&gt; EUR</span>
        <span class="s2">&quot;0x8343091F2499FD4b6174A46D067A920a3b851FF9&quot;</span><span class="p">:</span> <span class="s2">&quot;0xD647a6fC9BC6402301583C91decC5989d8Bc382D&quot;</span><span class="p">,</span>  <span class="c1"># jjpy -&gt; JPY</span>
        <span class="s2">&quot;0x6AE7Dfc73E0dDE2aa99ac063DcF7e8A63265108c&quot;</span><span class="p">:</span> <span class="s2">&quot;0xD647a6fC9BC6402301583C91decC5989d8Bc382D&quot;</span><span class="p">,</span>  <span class="c1"># jpyc -&gt; JPY</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Fantom</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0x21be370D5312f44cB42ce377BC9b8a0cEF1A4C83&quot;</span><span class="p">:</span> <span class="s2">&quot;0xf4766552D15AE4d256Ad41B6cf2933482B0680dc&quot;</span><span class="p">,</span>  <span class="c1"># wftm -&gt; FTM</span>
        <span class="s2">&quot;0x321162Cd933E2Be498Cd2267a90534A804051b11&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8e94C22142F4A64b99022ccDd994f4e9EC86E4B4&quot;</span><span class="p">,</span>  <span class="c1"># wbtc -&gt; BTC</span>
        <span class="s2">&quot;0x2406dCe4dA5aB125A18295f4fB9FD36a0f7879A2&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8e94C22142F4A64b99022ccDd994f4e9EC86E4B4&quot;</span><span class="p">,</span>  <span class="c1"># anybtc -&gt; BTC</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8e94C22142F4A64b99022ccDd994f4e9EC86E4B4&quot;</span><span class="p">,</span>  <span class="c1"># renbtc -&gt; BTC</span>
        <span class="s2">&quot;0x74b23882a30290451A17c44f4F05243b6b58C76d&quot;</span><span class="p">:</span> <span class="s2">&quot;0x11DdD3d147E5b83D01cee7070027092397d63658&quot;</span><span class="p">,</span>  <span class="c1"># weth -&gt; ETH</span>
        <span class="s2">&quot;0xBDC8fd437C489Ca3c6DA3B5a336D11532a532303&quot;</span><span class="p">:</span> <span class="s2">&quot;0x11DdD3d147E5b83D01cee7070027092397d63658&quot;</span><span class="p">,</span>  <span class="c1"># anyeth -&gt; ETH</span>
        <span class="s2">&quot;0x0694bf58a4F48C5970454CD4874218eBa843Cf3e&quot;</span><span class="p">:</span> <span class="s2">&quot;0x11DdD3d147E5b83D01cee7070027092397d63658&quot;</span><span class="p">,</span>  <span class="c1"># reneth -&gt; ETH</span>
        <span class="s2">&quot;0xd6070ae98b8069de6B494332d1A1a81B6179D960&quot;</span><span class="p">:</span> <span class="s2">&quot;0x4F5Cc6a2291c964dEc4C7d6a50c0D89492d4D91B&quot;</span><span class="p">,</span>  <span class="c1"># bifi -&gt; BIFI</span>
        <span class="s2">&quot;0x1E4F97b9f9F913c46F1632781732927B9019C68b&quot;</span><span class="p">:</span> <span class="s2">&quot;0xa141D7E3B44594cc65142AE5F2C7844Abea66D2B&quot;</span><span class="p">,</span>  <span class="c1"># crv -&gt; CRV</span>
        <span class="s2">&quot;0x6a07A792ab2965C72a5B8088d3a069A7aC3a993B&quot;</span><span class="p">:</span> <span class="s2">&quot;0xE6ecF7d2361B6459cBb3b4fb065E0eF4B175Fe74&quot;</span><span class="p">,</span>  <span class="c1"># aave -&gt; AAVE</span>
        <span class="s2">&quot;0x657A1861c15A3deD9AF0B6799a195a249ebdCbc6&quot;</span><span class="p">:</span> <span class="s2">&quot;0xD2fFcCfA0934caFdA647c5Ff8e7918A10103c01c&quot;</span><span class="p">,</span>  <span class="c1"># cream -&gt; CREAM</span>
        <span class="s2">&quot;0xb3654dc3D10Ea7645f8319668E8F54d2574FBdC8&quot;</span><span class="p">:</span> <span class="s2">&quot;0x221C773d8647BC3034e91a0c47062e26D20d97B4&quot;</span><span class="p">,</span>  <span class="c1"># link -&gt; LINK</span>
        <span class="s2">&quot;0x399fe752D39338d28C36F3370fbebd8292fb9E6e&quot;</span><span class="p">:</span> <span class="s2">&quot;0xb26867105D25bD127862bEA9B952Fa2E89942837&quot;</span><span class="p">,</span>  <span class="c1"># ohmv2 -&gt; OHM</span>
        <span class="s2">&quot;0x56ee926bD8c72B2d5fa1aF4d9E4Cbb515a1E3Adc&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2Eb00cC9dB7A7E0a013A49b3F6Ac66008d1456F7&quot;</span><span class="p">,</span>  <span class="c1"># snx -&gt; SNX</span>
        <span class="s2">&quot;0x468003B688943977e6130F4F68F23aad939a1040&quot;</span><span class="p">:</span> <span class="s2">&quot;0x02E48946849e0BFDD7bEa5daa80AF77195C7E24c&quot;</span><span class="p">,</span>  <span class="c1"># spell -&gt; SPELL</span>
        <span class="s2">&quot;0xae75A438b2E0cB8Bb01Ec1E1e376De11D44477CC&quot;</span><span class="p">:</span> <span class="s2">&quot;0xCcc059a1a17577676c8673952Dc02070D29e5a66&quot;</span><span class="p">,</span>  <span class="c1"># sushi -&gt; SUSHI</span>
        <span class="s2">&quot;0x81740D647493a61329E1c574A11ee7577659fb14&quot;</span><span class="p">:</span> <span class="s2">&quot;0x4be9c8fb4105380116c03fc2eeb9ea1e1a109d95&quot;</span><span class="p">,</span>  <span class="c1"># fchf -&gt; CHF</span>
        <span class="s2">&quot;0xe105621721D1293c27be7718e041a4Ce0EbB227E&quot;</span><span class="p">:</span> <span class="s2">&quot;0x3E68e68ea2c3698400465e3104843597690ae0f7&quot;</span><span class="p">,</span>  <span class="c1"># feur -&gt; EUR</span>
        <span class="s2">&quot;0x29b0Da86e484E1C0029B56e817912d778aC0EC69&quot;</span><span class="p">:</span> <span class="s2">&quot;0x9B25eC3d6acfF665DfbbFD68B3C1D896E067F0ae&quot;</span><span class="p">,</span>  <span class="c1"># yfi -&gt; YFI</span>
        <span class="s2">&quot;0xb3654dc3D10Ea7645f8319668E8F54d2574FBdC8&quot;</span><span class="p">:</span> <span class="s2">&quot;0x221C773d8647BC3034e91a0c47062e26D20d97B4&quot;</span><span class="p">,</span>  <span class="c1"># link -&gt; LINK</span>
        <span class="s2">&quot;0xae75A438b2E0cB8Bb01Ec1E1e376De11D44477CC&quot;</span><span class="p">:</span> <span class="s2">&quot;0xCcc059a1a17577676c8673952Dc02070D29e5a66&quot;</span><span class="p">,</span>  <span class="c1"># sushi -&gt; SUSHI</span>
        <span class="s2">&quot;0xd82a4f018eCF6be6E991C3c4a160C9758EC3338F&quot;</span><span class="p">:</span> <span class="s2">&quot;0xf8f57321c2e3E202394b0c0401FD6392C3e7f465&quot;</span><span class="p">,</span>  <span class="c1"># renbusd -&gt; BUSD</span>
        <span class="s2">&quot;0xf55941e971302C634c586416c43469F3EaD5ad3e&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF64b636c5dFe1d3555A847341cDC449f612307d0&quot;</span><span class="p">,</span>  <span class="c1"># renusdt -&gt; USDT</span>
        <span class="s2">&quot;0x6E48a0c5386211837d99DacA233f45EF5aa5f594&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2553f4eeb82d5A26427b8d1106C51499CBa5D99c&quot;</span><span class="p">,</span>  <span class="c1"># renusdc -&gt; USDC</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Avalanche</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0A77230d17318075983913bC2145DB16C7366156&quot;</span><span class="p">,</span>  <span class="c1"># wavax -&gt; AVAX</span>
        <span class="s2">&quot;0x408D4cD0ADb7ceBd1F1A1C33A0Ba2098E1295bAB&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2779D32d5166BAaa2B2b658333bA7e6Ec0C65743&quot;</span><span class="p">,</span>  <span class="c1"># wbtc -&gt; BTC</span>
        <span class="s2">&quot;0x50b7545627a5162F82A992c33b87aDc75187B218&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2779D32d5166BAaa2B2b658333bA7e6Ec0C65743&quot;</span><span class="p">,</span>  <span class="c1"># wbtc.e -&gt; btc</span>
        <span class="s2">&quot;0xf20d962a6c8f70c731bd838a3a388D7d48fA6e15&quot;</span><span class="p">:</span> <span class="s2">&quot;0x976B3D034E162d8bD72D6b9C989d545b839003b0&quot;</span><span class="p">,</span>  <span class="c1"># eth -&gt; eth</span>
        <span class="s2">&quot;0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB&quot;</span><span class="p">:</span> <span class="s2">&quot;0x976B3D034E162d8bD72D6b9C989d545b839003b0&quot;</span><span class="p">,</span>  <span class="c1"># weth.e -&gt; eth</span>
        <span class="s2">&quot;0x39cf1BD5f15fb22eC3D9Ff86b0727aFc203427cc&quot;</span><span class="p">:</span> <span class="s2">&quot;0x449A373A090d8A1e5F74c63Ef831Ceff39E94563&quot;</span><span class="p">,</span>  <span class="c1"># sushi -&gt; sushi</span>
        <span class="s2">&quot;0xf39f9671906d8630812f9d9863bBEf5D523c84Ab&quot;</span><span class="p">:</span> <span class="s2">&quot;0x9a1372f9b1B71B3A5a72E092AE67E172dBd7Daaa&quot;</span><span class="p">,</span>  <span class="c1"># uni -&gt; uni</span>
        <span class="s2">&quot;0x8eBAf22B6F053dFFeaf46f4Dd9eFA95D89ba8580&quot;</span><span class="p">:</span> <span class="s2">&quot;0x9a1372f9b1B71B3A5a72E092AE67E172dBd7Daaa&quot;</span><span class="p">,</span>  <span class="c1"># uni.e -&gt; uni</span>
        <span class="s2">&quot;0xB3fe5374F67D7a22886A0eE082b2E2f9d2651651&quot;</span><span class="p">:</span> <span class="s2">&quot;0x49ccd9ca821EfEab2b98c60dC60F518E765EDe9a&quot;</span><span class="p">,</span>  <span class="c1"># link -&gt; link</span>
        <span class="s2">&quot;0x5947BB275c521040051D82396192181b413227A3&quot;</span><span class="p">:</span> <span class="s2">&quot;0x49ccd9ca821EfEab2b98c60dC60F518E765EDe9a&quot;</span><span class="p">,</span>  <span class="c1"># link.e -&gt; link</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2779D32d5166BAaa2B2b658333bA7e6Ec0C65743&quot;</span><span class="p">,</span>  <span class="c1"># renbtc -&gt; BTC</span>
        <span class="s2">&quot;0xc4Ace9278e7E01755B670C0838c3106367639962&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2F194315f122d374a27973e259783d5C864A5bf6&quot;</span><span class="p">,</span>  <span class="c1"># renfil -&gt; FIL</span>
        <span class="s2">&quot;0x7c7DAAF2dB46fEFd067f002a69FD0BE14AeB159f&quot;</span><span class="p">:</span> <span class="s2">&quot;0x12Fe6A4DF310d4aD9887D27D4fce45a6494D4a4a&quot;</span><span class="p">,</span>  <span class="c1"># renluna -&gt; LUNA</span>
        <span class="s2">&quot;0x63a72806098Bd3D9520cC43356dD78afe5D386D9&quot;</span><span class="p">:</span> <span class="s2">&quot;0x3CA13391E9fb38a75330fb28f8cc2eB3D9ceceED&quot;</span><span class="p">,</span>  <span class="c1"># aave.e -&gt; aave</span>
        <span class="s2">&quot;0x6e84a6216eA6dACC71eE8E6b0a5B7322EEbC0fDd&quot;</span><span class="p">:</span> <span class="s2">&quot;0x02D35d3a8aC3e1626d3eE09A78Dd87286F5E8e3a&quot;</span><span class="p">,</span>  <span class="c1"># joe -&gt; joe</span>
        <span class="s2">&quot;0xCE1bFFBD5374Dac86a2893119683F4911a2F7814&quot;</span><span class="p">:</span> <span class="s2">&quot;0x4F3ddF9378a4865cf4f28BE51E10AECb83B7daeE&quot;</span><span class="p">,</span>  <span class="c1"># spell -&gt; spell</span>
        <span class="s2">&quot;0x8729438EB15e2C8B576fCc6AeCdA6A148776C0F5&quot;</span><span class="p">:</span> <span class="s2">&quot;0x36E039e6391A5E7A7267650979fdf613f659be5D&quot;</span><span class="p">,</span>  <span class="c1"># qi -&gt; qi</span>
        <span class="s2">&quot;0x027dbcA046ca156De9622cD1e2D907d375e53aa7&quot;</span><span class="p">:</span> <span class="s2">&quot;0xcf667FB6Bd30c520A435391c50caDcDe15e5e12f&quot;</span><span class="p">,</span>  <span class="c1"># ampl -&gt; ampl</span>
        <span class="s2">&quot;0x6E48a0c5386211837d99DacA233f45EF5aa5f594&quot;</span><span class="p">:</span> <span class="s2">&quot;0xF096872672F44d6EBA71458D74fe67F9a77a23B9&quot;</span><span class="p">,</span>  <span class="c1"># renusdc -&gt; USDC</span>
        <span class="s2">&quot;0xf55941e971302C634c586416c43469F3EaD5ad3e&quot;</span><span class="p">:</span> <span class="s2">&quot;0xEBE676ee90Fe1112671f19b6B7459bC678B67e8a&quot;</span><span class="p">,</span>  <span class="c1"># renusdt -&gt; USDT</span>
        <span class="s2">&quot;0xEB9aC3e1C9C3F919804Bdc412e0a39b94D4C09d3&quot;</span><span class="p">:</span> <span class="s2">&quot;0x51D7180edA2260cc4F6e4EebB82FEF5c3c2B8300&quot;</span><span class="p">,</span>  <span class="c1"># rendai -&gt; DAI</span>
        <span class="s2">&quot;0x0694bf58a4F48C5970454CD4874218eBa843Cf3e&quot;</span><span class="p">:</span> <span class="s2">&quot;0x976B3D034E162d8bD72D6b9C989d545b839003b0&quot;</span><span class="p">,</span>  <span class="c1"># reneth -&gt; ETH</span>
        <span class="s2">&quot;0x705Bc47EbA113Be1a66e20824a05a176aA3b5265&quot;</span><span class="p">:</span> <span class="s2">&quot;0x54EdAB30a7134A16a54218AE64C73e1DAf48a8Fb&quot;</span><span class="p">,</span>  <span class="c1"># renmim -&gt; MIM</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Arbitrum</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0x82aF49447D8a07e3bd95BD0d56f35241523fBab1&quot;</span><span class="p">:</span> <span class="s2">&quot;0x639Fe6ab55C921f74e7fac1ee960C0B6293ba612&quot;</span><span class="p">,</span>  <span class="c1"># weth -&gt; ETH</span>
        <span class="s2">&quot;0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f&quot;</span><span class="p">:</span> <span class="s2">&quot;0x6ce185860a4963106506C203335A2910413708e9&quot;</span><span class="p">,</span>  <span class="c1"># wbtc -&gt; BTC</span>
        <span class="s2">&quot;0xDBf31dF14B66535aF65AaC99C32e9eA844e14501&quot;</span><span class="p">:</span> <span class="s2">&quot;0x6ce185860a4963106506C203335A2910413708e9&quot;</span><span class="p">,</span>  <span class="c1"># renbtc -&gt; BTC</span>
        <span class="s2">&quot;0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1&quot;</span><span class="p">:</span> <span class="s2">&quot;0xc5C8E77B397E531B8EC06BFb0048328B30E9eCfB&quot;</span><span class="p">,</span>  <span class="c1"># dai -&gt; DAI</span>
        <span class="s2">&quot;0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8&quot;</span><span class="p">:</span> <span class="s2">&quot;0x50834F3163758fcC1Df9973b6e91f0F0F0434aD3&quot;</span><span class="p">,</span>  <span class="c1"># usdc -&gt; USDC</span>
        <span class="s2">&quot;0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9&quot;</span><span class="p">:</span> <span class="s2">&quot;0x3f3f5dF88dC9F13eac63DF89EC16ef6e7E25DdE7&quot;</span><span class="p">,</span>  <span class="c1"># usdt -&gt; USDT</span>
        <span class="s2">&quot;0xFEa7a6a0B346362BF88A9e4A88416B77a57D6c2A&quot;</span><span class="p">:</span> <span class="s2">&quot;0x87121F6c9A9F6E90E59591E4Cf4804873f54A95b&quot;</span><span class="p">,</span>  <span class="c1"># mim -&gt; MIM</span>
        <span class="s2">&quot;0xD22a58f79e9481D1a88e00c343885A588b34b68B&quot;</span><span class="p">:</span> <span class="s2">&quot;0xA14d53bC1F1c0F31B4aA3BD109344E5009051a84&quot;</span><span class="p">,</span>  <span class="c1"># eurs -&gt; EUR</span>
        <span class="s2">&quot;0x17FC002b466eEc40DaE837Fc4bE5c67993ddBd6F&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0809E3d38d1B4214958faf06D8b1B1a2b73f2ab8&quot;</span><span class="p">,</span>  <span class="c1"># frax -&gt; FRAX</span>
        <span class="s2">&quot;0xFa247d0D55a324ca19985577a2cDcFC383D87953&quot;</span><span class="p">:</span> <span class="s2">&quot;0xfF82AAF635645fD0bcc7b619C3F28004cDb58574&quot;</span><span class="p">,</span>  <span class="c1"># php -&gt; PHP</span>
        <span class="s2">&quot;0x82e3A8F066a6989666b031d916c43672085b1582&quot;</span><span class="p">:</span> <span class="s2">&quot;0x745Ab5b69E01E2BE1104Ca84937Bb71f96f5fB21&quot;</span><span class="p">,</span>  <span class="c1"># yfi -&gt; YFI</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Optimism</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0x68f180fcCe6836688e9084f035309E29Bf0A2095&quot;</span><span class="p">:</span> <span class="s2">&quot;0xD702DD976Fb76Fffc2D3963D037dfDae5b04E593&quot;</span><span class="p">,</span>  <span class="c1"># wbtc -&gt; BTC</span>
        <span class="s2">&quot;0x298B9B95708152ff6968aafd889c6586e9169f1D&quot;</span><span class="p">:</span> <span class="s2">&quot;0xD702DD976Fb76Fffc2D3963D037dfDae5b04E593&quot;</span><span class="p">,</span>  <span class="c1"># sbtc -&gt; BTC</span>
        <span class="s2">&quot;0x4200000000000000000000000000000000000006&quot;</span><span class="p">:</span> <span class="s2">&quot;0x13e3Ee699D1909E989722E753853AE30b17e08c5&quot;</span><span class="p">,</span>  <span class="c1"># weth -&gt; ETH</span>
        <span class="s2">&quot;0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8dBa75e83DA73cc766A7e5a0ee71F656BAb470d6&quot;</span><span class="p">,</span>  <span class="c1"># dai -&gt; DAI</span>
        <span class="s2">&quot;0x4200000000000000000000000000000000000042&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0D276FC14719f9292D5C1eA2198673d1f4269246&quot;</span><span class="p">,</span>  <span class="c1"># op -&gt; OP</span>
        <span class="s2">&quot;0x2E3D870790dC77A83DD1d18184Acc7439A53f475&quot;</span><span class="p">:</span> <span class="s2">&quot;0xc7D132BeCAbE7Dcc4204841F33bae45841e41D9C&quot;</span><span class="p">,</span>  <span class="c1"># frax -&gt; FRAX</span>
        <span class="s2">&quot;0x350a791Bfc2C21F9Ed5d10980Dad2e2638ffa7f6&quot;</span><span class="p">:</span> <span class="s2">&quot;0xCc232dcFAAE6354cE191Bd574108c1aD03f86450&quot;</span><span class="p">,</span>  <span class="c1"># link -&gt; LINK</span>
        <span class="s2">&quot;0x7F5c764cBc14f9669B88837ca1490cCa17c31607&quot;</span><span class="p">:</span> <span class="s2">&quot;0x16a9FA2FDa030272Ce99B29CF780dFA30361E0f3&quot;</span><span class="p">,</span>  <span class="c1"># usdc -&gt; USDC</span>
        <span class="s2">&quot;0x8700dAec35aF8Ff88c16BdF0418774CB3D7599B4&quot;</span><span class="p">:</span> <span class="s2">&quot;0x2FCF37343e916eAEd1f1DdaaF84458a359b53877&quot;</span><span class="p">,</span>  <span class="c1"># snx -&gt; SNX</span>
        <span class="s2">&quot;0x3c8B650257cFb5f272f799F5e2b4e65093a11a05&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0f2Ed59657e391746C1a097BDa98F2aBb94b1120&quot;</span><span class="p">,</span>  <span class="c1"># velo -&gt; VELO</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Base</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;0x4200000000000000000000000000000000000006&quot;</span><span class="p">:</span> <span class="s2">&quot;0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70&quot;</span><span class="p">,</span>  <span class="c1"># weth -&gt; ETH</span>
        <span class="s2">&quot;0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb&quot;</span><span class="p">:</span> <span class="s2">&quot;0x591e79239a7d679378eC8c847e5038150364C78F&quot;</span><span class="p">,</span>  <span class="c1"># dai -&gt; DAI</span>
    <span class="p">},</span>
    <span class="n">Network</span><span class="o">.</span><span class="n">Katana</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># https://docs.chain.link/data-feeds/price-feeds/addresses?page=1&amp;network=katana&amp;testnetPage=1&amp;search=</span>
        <span class="s2">&quot;0xEE7D8BCFb72bC1880D0Cf19822eB0A2e6577aB62&quot;</span><span class="p">:</span> <span class="s2">&quot;0x7BdBDB772f4a073BadD676A567C6ED82049a8eEE&quot;</span><span class="p">,</span>  <span class="c1"># WETH -&gt; ETH</span>
        <span class="s2">&quot;0x0913DA6Da4b42f538B445599b46Bb4622342Cf52&quot;</span><span class="p">:</span> <span class="s2">&quot;0x41DdB7F8F5e1b2bD28193B84C1C36Be698dEd162&quot;</span><span class="p">,</span>  <span class="c1"># WBTC -&gt; BTC</span>
    <span class="p">},</span>
<span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHAINID</span><span class="p">,</span> <span class="p">{})</span>

<span class="n">ONE_DAY</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>


<div class="viewcode-block" id="Feed">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Feed">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Feed</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a Chainlink price feed for a specific asset.</span>

<span class="sd">    This class encapsulates the information required to query a Chainlink feed.</span>
<span class="sd">    When initializing a Feed object, the first parameter should be the feed contract address</span>
<span class="sd">    and the second parameter should be the underlying asset address. Note that in the context of the</span>
<span class="sd">    :class:`~y.prices.chainlink.Chainlink` class, the internal FEEDS mapping holds keys as asset addresses</span>
<span class="sd">    and values as feed addresses; however, Feed instances are created with the feed address as the first argument.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Given a mapping entry: {asset_address: feed_address}</span>
<span class="sd">        &gt;&gt;&gt; feed = Feed(&quot;0xFeedAddress&quot;, &quot;0xAssetAddress&quot;, asynchronous=True)</span>
<span class="sd">        &gt;&gt;&gt; price = await feed.get_price(1234567)</span>
<span class="sd">        &gt;&gt;&gt; print(price)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;address&quot;</span><span class="p">,</span>
        <span class="s2">&quot;asset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;latest_answer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;latest_timestamp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_block&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_stale_thru_block&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<div class="viewcode-block" id="Feed.__init__">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Feed.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span> <span class="n">AnyAddressType</span><span class="p">,</span>
        <span class="n">asset</span><span class="p">:</span> <span class="n">AnyAddressType</span><span class="p">,</span>
        <span class="n">start_block</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">asynchronous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">convert</span><span class="o">.</span><span class="n">to_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="n">ERC20</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="n">asynchronous</span><span class="o">=</span><span class="n">asynchronous</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_block</span> <span class="o">=</span> <span class="n">start_block</span>
        <span class="c1"># we could make less calls by using latestRoundData but then we have to repeatedly decode a bunch of useless data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latest_answer</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="s2">&quot;latestAnswer()(int256)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">coroutine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latest_timestamp</span> <span class="o">=</span> <span class="n">Call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="s2">&quot;latestTimestamp()(uint256)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">coroutine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stale_thru_block</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> address=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2"> asset=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">asset</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">contract</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Contract</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Contract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>

    <span class="c1"># @a_sync.future</span>
<div class="viewcode-block" id="Feed.decimals">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Feed.decimals">[docs]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">decimals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">Call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="s2">&quot;decimals()(uint)&quot;</span><span class="p">)</span></div>


    <span class="c1"># @a_sync.future(cache_type=&#39;memory&#39;)</span>
<div class="viewcode-block" id="Feed.scale">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Feed.scale">[docs]</a>
    <span class="nd">@alru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">a_sync</span><span class="o">.</span><span class="n">ASyncFuture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">()))</span></div>


    <span class="c1"># @a_sync.future</span>
<div class="viewcode-block" id="Feed.get_price">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Feed.get_price">[docs]</a>
    <span class="nd">@stuck_coro_debugger</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UsdPrice</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the price of the asset at a specific block.</span>

<span class="sd">        If the feed is stale, returns None.</span>

<span class="sd">        Args:</span>
<span class="sd">            block: The block number to get the price for.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; feed = Feed(&quot;0xFeedAddr&quot;, &quot;0xAssetAddr&quot;)</span>
<span class="sd">            &gt;&gt;&gt; price = await feed.get_price(12345678)</span>
<span class="sd">            &gt;&gt;&gt; if price is not None:</span>
<span class="sd">            ...     print(f&quot;Price: {price}&quot;)</span>
<span class="sd">            ... else:</span>
<span class="sd">            ...     print(&quot;Feed is stale.&quot;)</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :func:`~y.prices.chainlink.Chainlink.get_price`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stale_thru_block</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stale_thru_block</span> <span class="o">&gt;</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is stale, must fetch price from elsewhere&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">updated_at</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_timestamp</span><span class="p">(</span><span class="n">block_id</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ContractLogicError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">updated_at</span> <span class="o">+</span> <span class="n">ONE_DAY</span> <span class="o">&lt;</span> <span class="k">await</span> <span class="n">time</span><span class="o">.</span><span class="n">get_block_timestamp_async</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
            <span class="c1"># if 24h have passed since last feed update, we can&#39;t trust it</span>
            <span class="c1"># NOTE: is there a way to tell on chain if a feed is retired? I haven&#39;t yet seen one go stale and come back</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is stale, must fetch price from elsewhere&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stale_thru_block</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">block</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stale_thru_block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stale_thru_block</span> <span class="o">=</span> <span class="n">block</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">latest_answer</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_answer</span><span class="p">(</span><span class="n">block_id</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;latest_answer: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">latest_answer</span><span class="p">)</span>
        <span class="c1"># NOTE: just playing with smth here</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">a_sync</span><span class="o">.</span><span class="n">ASyncFuture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">())</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">latest_answer</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">UsdPrice</span><span class="p">(</span><span class="k">await</span> <span class="n">price</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ContractLogicError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;execution reverted&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="n">price</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> price at </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">price</span></div>
</div>



<div class="viewcode-block" id="FeedsFromEvents">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.FeedsFromEvents">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FeedsFromEvents</span><span class="p">(</span><span class="n">ProcessedEvents</span><span class="p">[</span><span class="n">Feed</span><span class="p">]):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;asynchronous&quot;</span><span class="p">,)</span>

<div class="viewcode-block" id="FeedsFromEvents.__init__">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.FeedsFromEvents.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addresses</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">asynchronous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asynchronous</span> <span class="o">=</span> <span class="n">asynchronous</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">addresses</span><span class="o">=</span><span class="n">addresses</span><span class="p">,</span> <span class="n">topics</span><span class="o">=</span><span class="n">topics</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_include_event</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">_EventItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether to include a given event in this container.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: The event.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; include = FeedsFromEvents._include_event(event)</span>
<span class="sd">            &gt;&gt;&gt; print(include)</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the event should be included, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;denomination&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">DENOMINATIONS</span><span class="p">[</span><span class="s2">&quot;USD&quot;</span><span class="p">]</span>
            <span class="ow">and</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;latestAggregator&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ZERO_ADDRESS</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">_EventItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Feed</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Feed</span><span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;latestAggregator&quot;</span><span class="p">],</span>
            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;asset&quot;</span><span class="p">],</span>
            <span class="n">event</span><span class="o">.</span><span class="n">block_number</span><span class="p">,</span>
            <span class="n">asynchronous</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">asynchronous</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_block_for_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Feed</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">start_block</span></div>



<div class="viewcode-block" id="Chainlink">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Chainlink">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Chainlink</span><span class="p">(</span><span class="n">a_sync</span><span class="o">.</span><span class="n">ASyncGenericBase</span><span class="p">):</span>
<div class="viewcode-block" id="Chainlink.__init__">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Chainlink.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">asynchronous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Chainlink class.</span>

<span class="sd">        The Chainlink class aggregates Chainlink price feeds for various tokens.</span>
<span class="sd">        This constructor automatically creates Feed objects by inverting the FEEDS mapping,</span>
<span class="sd">        calling Feed(feed_address, asset_address). The FEEDS mapping is defined so that keys represent</span>
<span class="sd">        the asset addresses and values represent the corresponding feed addresses.</span>

<span class="sd">        Args:</span>
<span class="sd">            asynchronous: Whether to use asynchronous operations.</span>

<span class="sd">        Raises:</span>
<span class="sd">            UnsupportedNetwork: If Chainlink is not supported on the current network.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; chainlink = Chainlink(asynchronous=True)</span>
<span class="sd">            &gt;&gt;&gt; print(chainlink)</span>
<span class="sd">            &lt;Chainlink ...&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asynchronous</span> <span class="o">=</span> <span class="n">asynchronous</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feeds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Feed</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">asynchronous</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">asynchronous</span><span class="p">)</span> <span class="k">for</span> <span class="n">asset</span><span class="p">,</span> <span class="n">feed</span> <span class="ow">in</span> <span class="n">FEEDS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">CHAINID</span> <span class="ow">in</span> <span class="n">registries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registry</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="n">registries</span><span class="p">[</span><span class="n">CHAINID</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feeds_from_events</span> <span class="o">=</span> <span class="n">FeedsFromEvents</span><span class="p">(</span>
                <span class="n">addresses</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="p">),</span>
                <span class="n">topics</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">topics</span><span class="p">[</span><span class="s2">&quot;FeedConfirmed&quot;</span><span class="p">]],</span>
                <span class="n">asynchronous</span><span class="o">=</span><span class="n">asynchronous</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">FEEDS</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnsupportedNetwork</span><span class="p">(</span><span class="s2">&quot;chainlink is not supported on this network&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registry</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feeds_from_events</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_feeds_thru_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Feed</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield feeds up to a specific block.</span>

<span class="sd">        Args:</span>
<span class="sd">            block: The block number up to which feeds are yielded.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; async for feed in chainlink._feeds_thru_block(12345678):</span>
<span class="sd">            ...     print(feed)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feeds</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">feed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feeds_from_events</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feeds_from_events</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">to_block</span><span class="o">=</span><span class="n">block</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">feed</span>

<div class="viewcode-block" id="Chainlink.get_feed">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Chainlink.get_feed">[docs]</a>
    <span class="nd">@a_sync_ttl_cache</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">:</span> <span class="n">Address</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Feed</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the feed for a specific asset.</span>

<span class="sd">        The method converts the supplied asset address to an instance of :class:`~y.classes.common.ERC20`</span>
<span class="sd">        before performing the equality comparison. This allows a consistent lookup despite different input types.</span>
<span class="sd">        Please pass the token&#39;s address (e.g., &quot;0xAssetAddress&quot;).</span>

<span class="sd">        Args:</span>
<span class="sd">            asset: The address of the asset token.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; feed = await chainlink.get_feed(&quot;0xAssetAddress&quot;)</span>
<span class="sd">            &gt;&gt;&gt; if feed:</span>
<span class="sd">            ...     print(&quot;Found feed:&quot;, feed)</span>
<span class="sd">            ... else:</span>
<span class="sd">            ...     print(&quot;Feed not found.&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Feed object corresponding to the specified asset, or None if not found.</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`~y.prices.chainlink.Chainlink.has_feed`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">asset</span> <span class="o">=</span> <span class="k">await</span> <span class="n">convert</span><span class="o">.</span><span class="n">to_address_async</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feeds_thru_block</span><span class="p">(</span><span class="k">await</span> <span class="n">dank_mids</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">asset</span> <span class="o">==</span> <span class="n">feed</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">feed</span></div>


<div class="viewcode-block" id="Chainlink.has_feed">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Chainlink.has_feed">[docs]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">has_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">:</span> <span class="n">AnyAddressType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a feed exists for a specific asset.</span>

<span class="sd">        The supplied asset address is converted internally to an :class:`~y.classes.common.ERC20` instance</span>
<span class="sd">        before comparing to the stored feeds.</span>

<span class="sd">        Args:</span>
<span class="sd">            asset: The address of the asset token.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; exists = await chainlink.has_feed(&quot;0xAssetAddress&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(&quot;Feed exists:&quot;, exists)</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if a feed exists for the specified asset, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: We avoid using `get_feed` to prevent filling the cache with Nones unnecessarily</span>
        <span class="n">asset</span> <span class="o">=</span> <span class="n">convert</span><span class="o">.</span><span class="n">to_address</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feeds_thru_block</span><span class="p">(</span><span class="k">await</span> <span class="n">dank_mids</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">asset</span> <span class="o">==</span> <span class="n">feed</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>


    <span class="c1"># @a_sync.future</span>
<div class="viewcode-block" id="Chainlink.get_price">
<a class="viewcode-back" href="../../../source/y.prices.html#y.prices.chainlink.Chainlink.get_price">[docs]</a>
    <span class="nd">@stuck_coro_debugger</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_price</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">:</span> <span class="n">AnyAddressType</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Block</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UsdPrice</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the price of an asset at a specific block.</span>

<span class="sd">        If the block is not specified, the latest block is used.</span>
<span class="sd">        Note that the asset parameter is converted to a string (for caching purposes) after being processed as an ERC20 instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            asset: The address of the asset token.</span>
<span class="sd">            block: The block number to query the price at.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; price = await chainlink.get_price(&quot;0xAssetAddress&quot;, 12345678)</span>
<span class="sd">            &gt;&gt;&gt; if price is not None:</span>
<span class="sd">            ...     print(f&quot;Price at block 12345678: {price}&quot;)</span>
<span class="sd">            ... else:</span>
<span class="sd">            ...     print(&quot;Price could not be retrieved.&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The price of the asset in USD, or None if the price cannot be fetched.</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`~y.prices.chainlink.Chainlink.get_feed`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="k">await</span> <span class="n">dank_mids</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">block_number</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting price for </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_price</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">asset</span><span class="p">),</span> <span class="n">block</span><span class="p">)</span>  <span class="c1"># force to string for cache key</span></div>


    <span class="nd">@alru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ENVS</span><span class="o">.</span><span class="n">CACHE_TTL</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">Block</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UsdPrice</span><span class="p">]:</span>
        <span class="n">asset</span> <span class="o">=</span> <span class="n">convert</span><span class="o">.</span><span class="n">to_address</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">asset</span> <span class="o">==</span> <span class="n">ZERO_ADDRESS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">feed</span><span class="p">:</span> <span class="n">Feed</span>
        <span class="n">feed</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feed</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">block</span> <span class="o">&lt;</span> <span class="k">await</span> <span class="n">contract_creation_block_async</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">get_price</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;error for feed </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<span class="k">try</span><span class="p">:</span>
    <span class="n">chainlink</span> <span class="o">=</span> <span class="n">Chainlink</span><span class="p">(</span><span class="n">asynchronous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UnsupportedNetwork</span><span class="p">:</span>
    <span class="n">chainlink</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, BobTheBuidler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>